<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Experimental features • modulr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google analytics --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36176577-2', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">modulr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/motivation.html">Why DI for R?</a>
</li>
<li>
  <a href="../articles/modulr.html">Introduction</a>
</li>
<li>
  <a href="../articles/testing.html">Unit Testing</a>
</li>
<li>
  <a href="../articles/packages.html">Using modulr in packages</a>
</li>
<li>
  <a href="../articles/experimental.html">Experimental</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/aclemen1/modulr">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Experimental features</h1>
            
          </div>

    
    
<div class="contents">
<div id="futures" class="section level1">
<h1 class="hasAnchor">
<a href="#futures" class="anchor"></a>Futures</h1>
<p>Using <a href="https://CRAN.R-project.org/package=future">Henrik Bengtsson’s future package</a>, it is possible to evaluate modules asynchronously using various resources available to the user. For instance, evaluation of modules can be sequential, lazy, and/or parallelized (on multiple cores and/or on a cluster of machines).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># How many cores are available?</span>
<span class="kw">availableCores</span>()
<span class="co">#&gt; system </span>
<span class="co">#&gt;      4</span>

<span class="st">"foo"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="kw">future</span>({
    <span class="kw">Sys.sleep</span>(1L)
    <span class="st">"Hello"</span>
  }) <span class="op">%plan%</span><span class="st"> </span>multicore
}
<span class="co">#&gt; [2018-12-02T16:14:14 UTC] Defining 'foo' ... OK</span>

<span class="st">"bar"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="kw">future</span>({
    <span class="kw">Sys.sleep</span>(1L)
    <span class="st">"World"</span>
  }) <span class="op">%plan%</span><span class="st"> </span>multicore
}
<span class="co">#&gt; [2018-12-02T16:14:14 UTC] Defining 'bar' ... OK</span>

<span class="st">"foobar"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">f =</span> <span class="st">"foo"</span>,
  <span class="dt">b =</span> <span class="st">"bar"</span>
) <span class="op">%provides%</span><span class="st"> </span>{
  <span class="kw">paste0</span>(<span class="kw">value</span>(f), <span class="st">" "</span>, <span class="kw">value</span>(b), <span class="st">"!"</span>)
}
<span class="co">#&gt; [2018-12-02T16:14:14 UTC] Defining 'foobar' ... OK</span>

<span class="kw">system.time</span>(<span class="kw">print</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foobar"</span>)))
<span class="co">#&gt; [2018-12-02T16:14:14 UTC] Making 'foobar' ...</span>
<span class="co">#&gt; [2018-12-02T16:14:14 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-12-02T16:14:14 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:14 UTC] * Sorting 2 dependencies with 2 relations ... on 1 layer, OK</span>
<span class="co">#&gt; [2018-12-02T16:14:14 UTC] * Evaluating new and outdated dependencies ...</span>
<span class="co">#&gt; [2018-12-02T16:14:14 UTC] ** Evaluating #1/2 (layer #1/1): 'bar' ...</span>
<span class="co">#&gt; [2018-12-02T16:14:14 UTC] ** Evaluating #2/2 (layer #1/1): 'foo' ...</span>
<span class="co">#&gt; [2018-12-02T16:14:15 UTC] DONE ('foobar' in 1.1 secs)</span>
<span class="co">#&gt; [1] "Hello World!"</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.059   0.014   1.073</span></code></pre></div>
<p>It is often interesting to parallelize an already existing module. <code>modulr</code> comes with the handy <code>futurize</code> function for this purpose. The following two examples illustrate the difference between sequential and lazy orchestrations of parallelized modules.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"foo"</span> <span class="op">%provides%</span><span class="st"> </span>{ <span class="kw">Sys.sleep</span>(1L); <span class="st">"Hello"</span> }
<span class="co">#&gt; [2018-12-02T16:14:15 UTC] Defining 'foo' ... OK</span>
<span class="st">"bar"</span> <span class="op">%provides%</span><span class="st"> </span>{ <span class="kw">Sys.sleep</span>(1L); <span class="st">"World"</span> }
<span class="co">#&gt; [2018-12-02T16:14:15 UTC] Defining 'bar' ... OK</span>
<span class="st">"foobar"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">f =</span> <span class="st">"foo"</span>, 
  <span class="dt">b =</span> <span class="st">"bar"</span>
) <span class="op">%provides%</span><span class="st"> </span>{
  <span class="kw">paste0</span>(f, <span class="st">" "</span>, b, <span class="st">"!"</span>)
}
<span class="co">#&gt; [2018-12-02T16:14:15 UTC] Defining 'foobar' ... OK</span>

<span class="kw"><a href="../reference/futurize.html">futurize</a></span>(<span class="st">"foo"</span>, <span class="dt">strategy =</span> multicore)
<span class="co">#&gt; [2018-12-02T16:14:15 UTC] Defining 'foo/future' ... OK</span>
<span class="kw"><a href="../reference/futurize.html">futurize</a></span>(<span class="st">"bar"</span>, <span class="dt">strategy =</span> multicore)
<span class="co">#&gt; [2018-12-02T16:14:15 UTC] Defining 'bar/future' ... OK</span>

<span class="kw"><a href="../reference/futurize.html">futurize</a></span>(
  <span class="st">"foobar"</span>, 
  <span class="dt">name =</span> <span class="st">"foobar/sequential"</span>, 
  <span class="dt">dependencies =</span> <span class="kw">list</span>(<span class="dt">f =</span> <span class="st">"foo/future"</span>, <span class="dt">b =</span> <span class="st">"bar/future"</span>),
  <span class="dt">strategy =</span> sequential
)
<span class="co">#&gt; [2018-12-02T16:14:15 UTC] Defining 'foobar/sequential' ... OK</span>

<span class="kw">system.time</span>(fb_sequential &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foobar/sequential"</span>))
<span class="co">#&gt; [2018-12-02T16:14:16 UTC] Making 'foobar/sequential' ...</span>
<span class="co">#&gt; [2018-12-02T16:14:16 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-12-02T16:14:16 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:16 UTC] * Sorting 2 dependencies with 2 relations ... on 1 layer, OK</span>
<span class="co">#&gt; [2018-12-02T16:14:16 UTC] * Evaluating new and outdated dependencies ...</span>
<span class="co">#&gt; [2018-12-02T16:14:16 UTC] ** Evaluating #1/2 (layer #1/1): 'bar/future' ...</span>
<span class="co">#&gt; [2018-12-02T16:14:16 UTC] ** Evaluating #2/2 (layer #1/1): 'foo/future' ...</span>
<span class="co">#&gt; [2018-12-02T16:14:17 UTC] DONE ('foobar/sequential' in 1.1 secs)</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.073   0.023   1.073</span>
<span class="kw">system.time</span>(<span class="kw">print</span>(<span class="kw">value</span>(fb_sequential)))
<span class="co">#&gt; [1] "Hello World!"</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.001   0.000   0.001</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/touch.html">touch</a></span>(<span class="st">"foo/future"</span>)
<span class="co">#&gt; [2018-12-02T16:14:17 UTC] Touching 'foo/future' ... OK</span>
<span class="kw"><a href="../reference/touch.html">touch</a></span>(<span class="st">"bar/future"</span>)
<span class="co">#&gt; [2018-12-02T16:14:17 UTC] Touching 'bar/future' ... OK</span>
<span class="kw"><a href="../reference/futurize.html">futurize</a></span>(
  <span class="st">"foobar"</span>, 
  <span class="dt">name =</span> <span class="st">"foobar/lazy"</span>, 
  <span class="dt">dependencies =</span> <span class="kw">list</span>(<span class="dt">f =</span> <span class="st">"foo/future"</span>, <span class="dt">b =</span> <span class="st">"bar/future"</span>),
  <span class="dt">strategy =</span> sequential,
  <span class="dt">lazy =</span> <span class="ot">TRUE</span>
)
<span class="co">#&gt; [2018-12-02T16:14:17 UTC] Defining 'foobar/lazy' ... OK</span>

<span class="kw">system.time</span>(fb_lazy &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foobar/lazy"</span>))
<span class="co">#&gt; [2018-12-02T16:14:17 UTC] Making 'foobar/lazy' ...</span>
<span class="co">#&gt; [2018-12-02T16:14:17 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-12-02T16:14:17 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:17 UTC] * Sorting 2 dependencies with 2 relations ... on 1 layer, OK</span>
<span class="co">#&gt; [2018-12-02T16:14:17 UTC] * Evaluating new and outdated dependencies ...</span>
<span class="co">#&gt; [2018-12-02T16:14:17 UTC] ** Evaluating #1/2 (layer #1/1): 'bar/future' ...</span>
<span class="co">#&gt; [2018-12-02T16:14:17 UTC] ** Evaluating #2/2 (layer #1/1): 'foo/future' ...</span>
<span class="co">#&gt; [2018-12-02T16:14:17 UTC] DONE ('foobar/lazy' in 0.074 secs)</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.062   0.013   0.077</span>
<span class="kw">Sys.sleep</span>(<span class="fl">0.5</span>)
<span class="kw">system.time</span>(<span class="kw">print</span>(<span class="kw">value</span>(fb_lazy)))
<span class="co">#&gt; [1] "Hello World!"</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.011   0.009   0.420</span></code></pre></div>
</div>
<div id="package-isolation" class="section level1">
<h1 class="hasAnchor">
<a href="#package-isolation" class="anchor"></a>Package isolation</h1>
<p>Let us consider the following situation: most of your code rely on an old version of dplyr, say 0.4.1, and you want to migrate progressively to the latest version available on CRAN, say 0.7.0. How two different versions of dplyr can cohabitate in your ecosystem? <strong>Package isolation</strong> is an experimental feature allowing to isolate a portion of code, for example a module, from already loaded and attached packages.</p>
<div id="using-other-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#using-other-packages" class="anchor"></a>Using other packages</h2>
<p>Let us assume that dplyr_0.4.1 is installed in the current library paths:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)  <span class="co"># version 0.4.1, installed in the library paths</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following object is masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw">print</span>(<span class="kw">sessionInfo</span>())
<span class="co">#&gt; R version 3.2.5 (2016-04-14)</span>
<span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">#&gt; Running under: Red Hat Enterprise Linux</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span>
<span class="co">#&gt;  [3] LC_TIME=en_DK.UTF-8        LC_COLLATE=en_US.UTF-8    </span>
<span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span>
<span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span>
<span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span>
<span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] dplyr_0.4.1        memoise_1.1.0      future_1.10.0     </span>
<span class="co">#&gt; [4] RColorBrewer_1.1-2 chorddiag_0.1.1    networkD3_0.2.13  </span>
<span class="co">#&gt; [7] modulr_0.1.7.9208 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] igraph_1.0.1          Rcpp_0.12.19          rstudioapi_0.8.0.9000</span>
<span class="co">#&gt;  [4] knitr_1.19            magrittr_1.5          pooh_0.3-2           </span>
<span class="co">#&gt;  [7] stringr_1.3.1         globals_0.12.4        tools_3.2.5          </span>
<span class="co">#&gt; [10] parallel_3.2.5        DBI_0.6-1             withr_2.1.2          </span>
<span class="co">#&gt; [13] htmltools_0.3.6       yaml_2.1.16           assertthat_0.2.0     </span>
<span class="co">#&gt; [16] rprojroot_1.3-2       digest_0.6.18         htmlwidgets_0.8      </span>
<span class="co">#&gt; [19] codetools_0.2-14      evaluate_0.10.1       rmarkdown_1.8        </span>
<span class="co">#&gt; [22] stringi_1.2.4         backports_1.1.2       listenv_0.7.0</span></code></pre></div>
<p>This is the current code using dplyr_0.4.1, where <code>arrange</code> applies by default to every element of the group:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cars <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(speed) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(dist)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>ungroup <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>head
<span class="co">#&gt; Source: local data frame [6 x 2]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   speed dist</span>
<span class="co">#&gt; 1     4   10</span>
<span class="co">#&gt; 2     4    2</span>
<span class="co">#&gt; 3     7   22</span>
<span class="co">#&gt; 4     7    4</span>
<span class="co">#&gt; 5     8   16</span>
<span class="co">#&gt; 6     9   10</span></code></pre></div>
<p>Let us isolate from all the loaded and attached packages (except the so-called <em>base</em> packages and a few others, like modulr itself, obviously):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">isolate_from_packages</span>()
<span class="co">#&gt; [2018-12-02T16:14:18 UTC] Isolating from loaded and attached packages ...</span>
<span class="co">#&gt; [2018-12-02T16:14:18 UTC] * Ignoring base packages and 14 packages: 'assertthat', 'curl', 'devtools', 'digest', 'httr', 'jsonlite', 'knitr', 'memoise', 'modulr', 'pooh', 'rmarkdown', 'rstudioapi', 'stringi', 'stringr'.</span>
<span class="co">#&gt; [2018-12-02T16:14:18 UTC] * Forgetting 'dplyr' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:19 UTC] * Forgetting 'future' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:19 UTC] * Forgetting 'RColorBrewer' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:19 UTC] * Forgetting 'chorddiag' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:19 UTC] * Forgetting 'networkD3' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:19 UTC] * Unloading 'igraph' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:19 UTC] * Unloading 'Rcpp' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:19 UTC] * Unloading 'magrittr' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:19 UTC] * Unloading 'globals' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:19 UTC] * Unloading 'DBI' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:19 UTC] * Unloading 'withr' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:19 UTC] * Unloading 'htmltools' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:19 UTC] * Unloading 'lazyeval' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:19 UTC] * Unloading 'yaml' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:19 UTC] * Unloading 'rprojroot' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:19 UTC] * Unloading 'htmlwidgets' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:20 UTC] * Unloading 'codetools' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:20 UTC] * Unloading 'evaluate' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:20 UTC] * Unloading 'backports' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:20 UTC] * Unloading 'listenv' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:20 UTC] Isolated from loaded and attached packages.</span></code></pre></div>
<p>This function returns a <em>packages manifest</em> containing all the necessary information to restore the situation. The last manifest produced by <code>isolate_from_packages</code> is available from the <code>.Last.packages_manifest</code> variable and is used by <code>restore_packages</code> (see <em>infra</em>).</p>
<p>Let us now suppose that dplyr_0.7.0 and its dependencies have been installed in the dedicated “./new_lib” directory. We can then change the library path to point to <code>./new_lib</code>, and attach the packages as usual:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">.libPaths</span>(<span class="st">"./new_lib"</span>)
<span class="kw">library</span>(dplyr)  <span class="co"># version 0.7.0, installed in "./new_lib"</span>
<span class="kw">print</span>(<span class="kw">sessionInfo</span>())</code></pre></div>
<pre><code>#&gt; 
#&gt; Attaching package: 'dplyr'
#&gt; The following objects are masked from 'package:stats':
#&gt; 
#&gt;     filter, lag
#&gt; The following objects are masked from 'package:base':
#&gt; 
#&gt;     intersect, setdiff, setequal, union
#&gt; R version 3.2.5 (2016-04-14)
#&gt; Platform: x86_64-pc-linux-gnu (64-bit)
#&gt; Running under: Red Hat Enterprise Linux
#&gt; 
#&gt; locale:
#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
#&gt;  [3] LC_TIME=en_DK.UTF-8        LC_COLLATE=en_US.UTF-8    
#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt; [1] dplyr_0.7.0       memoise_1.1.0     modulr_0.1.7.9208
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] Rcpp_0.12.11          rstudioapi_0.8.0.9000 magrittr_1.5         
#&gt;  [4] knitr_1.19            devtools_1.13.2       R6_2.2.1             
#&gt;  [7] rlang_0.1.1           pooh_0.3-2            stringr_1.3.1        
#&gt; [10] tools_3.2.5           parallel_3.2.5        assertthat_0.2.0     
#&gt; [13] digest_0.6.18         tibble_1.3.3          glue_1.1.0           
#&gt; [16] evaluate_0.10         rmarkdown_1.8         stringi_1.2.4</code></pre>
<p>Thus, the following code uses dplyr_0.7.0: a tibble is returned instead of a data frame and the verb <code>arrange</code> requires a parameter (<code>.by_group = TRUE</code>) to apply to every element of the group:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cars <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(speed) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(dist), <span class="dt">.by_group =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>ungroup <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>head
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   speed  dist</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1     4    10</span>
<span class="co">#&gt; 2     4     2</span>
<span class="co">#&gt; 3     7    22</span>
<span class="co">#&gt; 4     7     4</span>
<span class="co">#&gt; 5     8    16</span>
<span class="co">#&gt; 6     9    10</span></code></pre></div>
<p>Finally, we can restore the previously attached and loaded packages (by default, the previous library paths are also restored), based by default on the last manifest:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">restore_packages</span>()
<span class="co">#&gt; [2018-12-02T16:14:20 UTC] Restoring previously attached and loaded packages ...</span>
<span class="co">#&gt; [2018-12-02T16:14:20 UTC] * Restoring library paths ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:20 UTC] * Forgetting 'dplyr' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:20 UTC] * Unloading 'Rcpp' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:20 UTC] * Unloading 'magrittr' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Unloading 'R6' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Unloading 'rlang' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Unloading 'tibble' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Unloading 'glue' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Unloading 'evaluate' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Loading 'listenv' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Loading 'backports' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Loading 'evaluate' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Loading 'codetools' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Loading 'htmlwidgets' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Loading 'rprojroot' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Loading 'yaml' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Loading 'lazyeval' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Loading 'htmltools' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Loading 'withr' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Loading 'DBI' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Loading 'globals' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Loading 'magrittr' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Loading 'Rcpp' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Loading 'igraph' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Attaching 'dplyr' at position 2 ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Attaching 'future' at position 4 ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Attaching 'RColorBrewer' at position 5 ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Attaching 'chorddiag' at position 6 ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] * Attaching 'networkD3' at position 7 ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:21 UTC] Previously attached and loaded packages restored.</span>
<span class="kw">print</span>(<span class="kw">sessionInfo</span>())
<span class="co">#&gt; R version 3.2.5 (2016-04-14)</span>
<span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">#&gt; Running under: Red Hat Enterprise Linux</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span>
<span class="co">#&gt;  [3] LC_TIME=en_DK.UTF-8        LC_COLLATE=en_US.UTF-8    </span>
<span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span>
<span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span>
<span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span>
<span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] dplyr_0.4.1        memoise_1.1.0      future_1.10.0     </span>
<span class="co">#&gt; [4] RColorBrewer_1.1-2 chorddiag_0.1.1    networkD3_0.2.13  </span>
<span class="co">#&gt; [7] modulr_0.1.7.9208 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] Rcpp_0.12.19          pillar_1.1.0          tools_3.2.5          </span>
<span class="co">#&gt;  [4] digest_0.6.18         evaluate_0.10.1       rlang_0.3.0.1        </span>
<span class="co">#&gt;  [7] igraph_1.0.1          DBI_0.6-1             rstudioapi_0.8.0.9000</span>
<span class="co">#&gt; [10] yaml_2.1.16           parallel_3.2.5        withr_2.1.2          </span>
<span class="co">#&gt; [13] stringr_1.3.1         knitr_1.19            globals_0.12.4       </span>
<span class="co">#&gt; [16] htmlwidgets_0.8       devtools_1.13.2       rprojroot_1.3-2      </span>
<span class="co">#&gt; [19] listenv_0.7.0         pooh_0.3-2            rmarkdown_1.8        </span>
<span class="co">#&gt; [22] magrittr_1.5          backports_1.1.2       codetools_0.2-14     </span>
<span class="co">#&gt; [25] htmltools_0.3.6       assertthat_0.2.0      stringi_1.2.4        </span>
<span class="co">#&gt; [28] lazyeval_0.2.0</span></code></pre></div>
</div>
<div id="temporarily-using-other-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#temporarily-using-other-packages" class="anchor"></a>Temporarily using other packages</h2>
<p>The <code>with_packages</code> function allows to isolate temporarily a portion of code, so that the previous example simply becomes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/with_verbosity.html">with_verbosity</a></span>(1L, <span class="kw"><a href="../reference/with_no_packages.html">with_packages</a></span>(<span class="st">"./new_lib"</span>, {
  <span class="kw">library</span>(dplyr)
  cars <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(speed) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(dist), <span class="dt">.by_group =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>ungroup <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">as.data.frame</span>(<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>head
}))</code></pre></div>
<pre><code>#&gt; [2018-12-02T16:14:21 UTC] Isolating from loaded and attached packages ...
#&gt; [2018-12-02T16:14:24 UTC] Isolated from loaded and attached packages.
#&gt; 
#&gt; Attaching package: 'dplyr'
#&gt; The following objects are masked from 'package:stats':
#&gt; 
#&gt;     filter, lag
#&gt; The following objects are masked from 'package:base':
#&gt; 
#&gt;     intersect, setdiff, setequal, union
#&gt; [2018-12-02T16:14:24 UTC] Restoring previously attached and loaded packages ...
#&gt; [2018-12-02T16:14:25 UTC] Previously attached and loaded packages restored.
#&gt;   speed dist
#&gt; 1     4   10
#&gt; 2     4    2
#&gt; 3     7   22
#&gt; 4     7    4
#&gt; 5     8   16
#&gt; 6     9   10</code></pre>
<p>When working with modules, it is sometimes useful to associate a specific library to an on-disk module with <code>with_module_packages</code> or to a namespace of modules with <code>with_namespace_packages</code>.</p>
<p>In the following example, <code>with_module_packages</code> temporarily sets the library path to the sub-directory <code>lib/x86_64-pc-linux-gnu-library/3.2</code> of the directory <code>experimental/arranged_cars</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># File: ./modules/experimental/arranged_cars.R</span>

<span class="kw">library</span>(modulr)

<span class="st">"experimental/arranged_cars"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="kw"><a href="../reference/with_verbosity.html">with_verbosity</a></span>(0L, <span class="kw"><a href="../reference/with_no_packages.html">with_module_packages</a></span>({
    <span class="cf">if</span> (<span class="op">!</span><span class="st">"dplyr"</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(<span class="kw">installed.packages</span>()))
      <span class="kw">install.packages</span>(<span class="st">"dplyr"</span>)
    <span class="kw">library</span>(dplyr)
    cars <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">group_by</span>(speed) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">arrange</span>(<span class="kw">desc</span>(dist), <span class="dt">.by_group =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">      </span>ungroup <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">as.data.frame</span>(<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">      </span>head
  }))
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"experimental/arranged_cars"</span>)
<span class="co">#&gt; [2018-12-02T16:14:25 UTC] Making 'experimental/arranged_cars' ...</span>
<span class="co">#&gt; [2018-12-02T16:14:25 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-12-02T16:14:25 UTC] ** Defining 'experimental/arranged_cars' ... OK</span>
<span class="co">#&gt; [2018-12-02T16:14:25 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="co">#&gt; [2018-12-02T16:14:30 UTC] DONE ('experimental/arranged_cars' in 4.5 secs)</span>
<span class="co">#&gt;   speed dist</span>
<span class="co">#&gt; 1     4   10</span>
<span class="co">#&gt; 2     4    2</span>
<span class="co">#&gt; 3     7   22</span>
<span class="co">#&gt; 4     7    4</span>
<span class="co">#&gt; 5     8   16</span>
<span class="co">#&gt; 6     9   10</span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#futures">Futures</a></li>
      <li>
<a href="#package-isolation">Package isolation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#using-other-packages">Using other packages</a></li>
      <li><a href="#temporarily-using-other-packages">Temporarily using other packages</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Alain Clément.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
