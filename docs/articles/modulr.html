<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to modulr • modulr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">modulr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/modulr.html">Vignette</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/aclemen1/modulr">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="modulr_files/htmlwidgets-0.8/htmlwidgets.js"></script><script src="modulr_files/d3-3.5.15/d3.min.js"></script><script src="modulr_files/sankey-1/sankey.js"></script><script src="modulr_files/sankeyNetwork-binding-0.2.13/sankeyNetwork.js"></script><script src="modulr_files/d3-tip-0.6.7/index.js"></script><link href="modulr_files/chorddiag-0.0.0.9000/chorddiag.css" rel="stylesheet">
<script src="modulr_files/chorddiag-0.0.0.9000/chorddiag.js"></script><script src="modulr_files/chorddiag-binding-0.1.1/chorddiag.js"></script><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Introduction to modulr</h1>
            
          </div>

    
    
<div class="contents">
<p>Modulr is a <a href="https://en.wikipedia.org/wiki/Dependency_injection">Dependency Injection</a> (DI) framework for R. It allows to break down sequential programs into discrete, modular units that are loosely coupled, simple to develop, test, reuse and share. See the <a href="https://github.com/aclemen1/modulr">README file</a> for a short introduction.</p>
<div id="anatomy-of-a-module" class="section level2">
<h2 class="hasAnchor">
<a href="#anatomy-of-a-module" class="anchor"></a>Anatomy of a module</h2>
<p>Modules are defined in a declarative way, using the keywords <code>%requires%</code> and <code>%provides%</code>, and have four main components:</p>
<ul>
<li>A <strong>name</strong>, which identifies the module.</li>
<li>A list of required <strong>dependencies</strong>, if any.</li>
<li>A <strong>provider</strong>, which expresses the module’s feature(s).</li>
<li>Optional <strong>docstrings</strong>, intended to document the internals of a module.</li>
</ul>
<p>A typical module looks like the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"name_of_module"</span> %requires%<span class="st"> </span><span class="kw">list</span>(

  <span class="co"># A list of dependencies.</span>
  <span class="dt">dependency_1 =</span> <span class="st">"name_of_dependency_1"</span>, 
  <span class="dt">dependency_2 =</span> <span class="st">"name_of_dependency_1"</span>,
  <span class="dt">... =</span> <span class="st">"..."</span>

) %provides%<span class="st"> </span>{

  <span class="co">#' A recommended docstring intended to document the internals of the module.</span>

  <span class="co"># A section where add-on packages are loaded and attached.</span>
  <span class="kw">library</span>(package_1)
  <span class="kw">library</span>(package_2)
  <span class="kw">library</span>(...)

  <span class="co"># Some code that uses the objects `dependency_1` and `dependency_2" </span>
  <span class="co"># returned by the modules "name_of_dependency_1" and "name_of_dependency_2".</span>
  object &lt;-<span class="st"> </span>{ ... }

  <span class="co"># A resulting object, which can be directly consumed or in turn injected as a </span>
  <span class="co"># dependency.</span>
  <span class="kw">return</span>(object)

} </code></pre></div>
<p>When a module is defined, modulr has to <em>make</em> it in order to evaluate the code it provides:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"name_of_module"</span>) </code></pre></div>
<p>or with a handy <em>syntactic sugar</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result %&lt;=%<span class="st"> "name_of_module"</span> </code></pre></div>
<p>or interactively with the <code>hit</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/hit.html">hit</a></span>(name_of_module) <span class="co"># or</span>
<span class="kw"><a href="../reference/hit.html">hit</a></span>(name_of) <span class="co"># which will prompt the user to choose among all possible match</span></code></pre></div>
<p>The result contains the computed object exposed by the module. Under the hood, the dependencies have been sorted and appropriately made, and their resulting objects injected where required.</p>
</div>
<div id="a-first-example" class="section level2">
<h2 class="hasAnchor">
<a href="#a-first-example" class="anchor"></a>A first example</h2>
<p>Let us start by defining some modules and dependencies:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"foo"</span> %provides%<span class="st"> "Hello"</span>
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] Defining 'foo' ... OK</span>

<span class="st">"bar"</span> %provides%<span class="st"> "World"</span>
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] Defining 'bar' ... OK</span>

<span class="st">"baz"</span> %provides%<span class="st"> "!"</span>
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] Defining 'baz' ... OK</span>

<span class="st">"foobar"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">f =</span> <span class="st">"foo"</span>, 
  <span class="dt">b =</span> <span class="st">"bar"</span>,
  <span class="dt">z =</span> <span class="st">"baz"</span>
) %provides%<span class="st"> </span>{ 
  <span class="co">#' Return a concatenated string. </span>
  <span class="kw">paste0</span>(f, <span class="st">", "</span>, <span class="kw">tolower</span>(b), z) 
} 
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] Defining 'foobar' ... OK</span></code></pre></div>
<p>Use <code>info</code> to output the docstrings:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/print_info.html">info</a></span>(<span class="st">"foobar"</span>) 
<span class="co">#&gt; Return a concatenated string.</span></code></pre></div>
<p>Use <code>lsmod</code> to list all defined modules and their properties in a data frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/list_modules.html">lsmod</a></span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">"name"</span>, <span class="st">"type"</span>, <span class="st">"dependencies"</span>, <span class="st">"uses"</span>, <span class="st">"size"</span>, <span class="st">"modified"</span>)) 
<span class="co">#&gt;     name type dependencies uses      size                modified</span>
<span class="co">#&gt; 1    bar &lt;NA&gt;            0    1 152 bytes 2017-06-15T15:33:07 UTC</span>
<span class="co">#&gt; 2    baz &lt;NA&gt;            0    1 152 bytes 2017-06-15T15:33:07 UTC</span>
<span class="co">#&gt; 3    foo &lt;NA&gt;            0    1 152 bytes 2017-06-15T15:33:07 UTC</span>
<span class="co">#&gt; 4 foobar &lt;NA&gt;            3    0    5.2 Kb 2017-06-15T15:33:07 UTC</span></code></pre></div>
<p>In this example, <code>foobar</code> relies on three dependencies, and <code>foo</code>, <code>bar</code> and <code>baz</code> are both injected once. Use <code>plot_dependencies</code> to see these relations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_dependencies.html">plot_dependencies</a></span>() </code></pre></div>
<div id="htmlwidget-1d9f9b9fdca3023baa83" style="width:90%;height:384px;" class="sankeyNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-1d9f9b9fdca3023baa83">{"x":{"links":{"source":[0,1,2],"target":[3,3,3],"value":[1,1,1]},"nodes":{"name":["foo","bar","baz","foobar"],"group":["foo","bar","baz","foobar"]},"options":{"NodeID":"node","NodeGroup":"node","LinkGroup":null,"colourScale":"d3.scale.category20()","fontSize":13,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":32}},"evals":[],"jsHooks":[]}</script><div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_dependencies.html">plot_dependencies</a></span>(<span class="dt">render_engine =</span> chord_engine) </code></pre></div>
<div id="htmlwidget-b18b48ec4ad649442f3b" style="width:90%;height:384px;" class="chorddiag html-widget"></div>
<script type="application/json" data-for="htmlwidget-b18b48ec4ad649442f3b">{"x":{"matrix":[[0,1,1,1],[1,0,0,0],[1,0,0,0],[1,0,0,0]],"options":{"type":"bipartite","width":null,"height":null,"margin":100,"showGroupnames":true,"groupNames":["foobar","foo","baz","bar"],"groupColors":["#E41A1C","#7E6E85","#E1C62F","#999999"],"groupThickness":0.1,"groupPadding":0.0349065850398866,"groupnamePadding":[10,10,10,10],"groupnameFontsize":11,"groupedgeColor":null,"chordedgeColor":"#808080","categoryNames":["module","dependency"],"categorynamePadding":100,"categorynameFontsize":28,"showTicks":false,"tickInterval":0.1,"ticklabelFontsize":10,"fadeLevel":0.1,"showTooltips":true,"showZeroTooltips":true,"tooltipNames":["foobar","foo","baz","bar"],"tooltipFontsize":12,"tooltipUnit":"","tooltipGroupConnector":" &#x25B6; ","precision":"null","clickAction":null}},"evals":[],"jsHooks":[]}</script><p>Use <code>make</code> to get the resulting object provided by the module:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foobar"</span>)
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] Making 'foobar' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] * Sorting 3 dependencies with 3 relations ... on 1 layer, OK</span>
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] * Evaluating new and outdated dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] ** Evaluating #1/3 (layer #1/1): 'baz' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] ** Evaluating #2/3 (layer #1/1): 'bar' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] ** Evaluating #3/3 (layer #1/1): 'foo' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] DONE ('foobar')</span>
<span class="co">#&gt; [1] "Hello, world!"</span></code></pre></div>
<p>Voilà! All the depencencies have been evaluated, injected and processed to return the expected <code>"Hello, world!"</code>. As a matter of fact, the dependencies form a <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph">directed acyclic graph</a> which is topologically sorted in order to determine a well ordering for their evaluation before injection.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/list_modules.html">lsmod</a></span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">"name"</span>, <span class="st">"type"</span>, <span class="st">"dependencies"</span>, <span class="st">"uses"</span>, <span class="st">"size"</span>, <span class="st">"modified"</span>)) 
<span class="co">#&gt;     name      type dependencies uses      size                modified</span>
<span class="co">#&gt; 1    bar character            0    1 152 bytes 2017-06-15T15:33:07 UTC</span>
<span class="co">#&gt; 2    baz character            0    1 152 bytes 2017-06-15T15:33:07 UTC</span>
<span class="co">#&gt; 3    foo character            0    1 152 bytes 2017-06-15T15:33:07 UTC</span>
<span class="co">#&gt; 4 foobar character            3    0    5.2 Kb 2017-06-15T15:33:07 UTC</span></code></pre></div>
</div>
<div id="types-of-modules" class="section level2">
<h2 class="hasAnchor">
<a href="#types-of-modules" class="anchor"></a>Types of modules</h2>
<div id="singletons" class="section level3">
<h3 class="hasAnchor">
<a href="#singletons" class="anchor"></a>Singletons</h3>
<p>All modules are singletons: once evaluated, they always return the same resulting object. This is one of the great advantages of modulr: module evaluation takes place parsimoniously, when changes are detected or explicitely required, à la <a href="https://www.gnu.org/software/make">GNU Make</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"timestamp"</span> %provides%<span class="st"> </span>{
  <span class="co">#' Return a string containing a timestamp.</span>
  <span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">"%H:%M:%OS6"</span>)
}
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] Defining 'timestamp' ... OK</span></code></pre></div>
<p>Successive <code>make</code> calls on the module will not imply its re-evaluation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"timestamp"</span>)
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] Making 'timestamp' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] DONE ('timestamp')</span>
<span class="co">#&gt; [1] "15:33:07.709564"</span>
<span class="kw"><a href="../reference/with_verbosity.html">with_verbosity</a></span>(<span class="dv">0</span>, <span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"timestamp"</span>)) <span class="co"># temporarily change the verbosity of make</span>
<span class="co">#&gt; [1] "15:33:07.709564"</span></code></pre></div>
<p>Notice the <code>with_verbosity</code> wrapper around the call. To force re-evaluation, just <code>touch</code> the module:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/touch.html">touch</a></span>(<span class="st">"timestamp"</span>)
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] Touching 'timestamp' ... OK</span>
<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"timestamp"</span>)
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] Making 'timestamp' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:07 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:08 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:08 UTC] DONE ('timestamp')</span>
<span class="co">#&gt; [1] "15:33:08.010162"</span></code></pre></div>
<p>Any change of the module’s definition (even its docstrings) will be detected:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"timestamp"</span> %provides%<span class="st"> </span>{
  <span class="co">#' Return a string containing a timestamp with more information.</span>
  <span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">"%Y-%m-%d %H:%M:%OS6"</span>)
}
<span class="co">#&gt; [2017-06-15T15:33:08 UTC] Re-defining 'timestamp' ... OK</span>

<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"timestamp"</span>)
<span class="co">#&gt; [2017-06-15T15:33:08 UTC] Making 'timestamp' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:08 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:08 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:08 UTC] DONE ('timestamp')</span>
<span class="co">#&gt; [1] "2017-06-15 15:33:08.036871"</span></code></pre></div>
</div>
<div id="prototypes" class="section level3">
<h3 class="hasAnchor">
<a href="#prototypes" class="anchor"></a>Prototypes</h3>
<p>It is granted that all modules are singletons. Nonetheless, a module is allowed to return any object, in particular it can return a function (closure) that itself returns a desired object or produces some side effect. In this case, such a module behaves like a so-called <em>prototype</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"timestamp"</span> %provides%<span class="st"> </span>{
  function() <span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">"%H:%M:%OS6"</span>)
}
<span class="co">#&gt; [2017-06-15T15:33:08 UTC] Defining 'timestamp' ... OK</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"timestamp"</span>)()
<span class="co">#&gt; [2017-06-15T15:33:08 UTC] Making 'timestamp' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:08 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:08 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:08 UTC] DONE ('timestamp')</span>
<span class="co">#&gt; [1] "15:33:08.082633"</span>

<span class="kw"><a href="../reference/with_verbosity.html">with_verbosity</a></span>(0L, <span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"timestamp"</span>)())
<span class="co">#&gt; [1] "15:33:08.098173"</span></code></pre></div>
<p>It is important to emphasize that the module is still a singleton: the second <code>make</code> call doesn’t re-evaluate. But the function that is returned by the module is itself re-evaluated each time it is called.</p>
</div>
<div id="memoised-prototypes" class="section level3">
<h3 class="hasAnchor">
<a href="#memoised-prototypes" class="anchor"></a>Memoised prototypes</h3>
<p>Singletons produce cached objects at make-time and prototypes produce computed objects at run-time. In a complementary manner, memoised modules produce cached objects at run-time. <a href="https://en.wikipedia.org/wiki/Memoization">Memoisation</a> and <a href="https://github.com/hadley/memoise">Hadley Wickam’s memoise package</a> give an elegant solution to this requirement.</p>
<p>To see the essence of what is happening, we decrease the verbosity of modulr and set up a simple starting scenario: <code>foo</code> requires the somewhat resource-consuming <code>timestamp</code> module, defined as a singleton:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/set_verbosity.html">set_verbosity</a></span>(1L) <span class="co"># messages are shown only when changes occur</span>

<span class="st">"timestamp"</span> %provides%<span class="st"> </span>{
  <span class="co"># This is a singleton.</span>
  <span class="kw">message</span>(<span class="st">"'timestamp' is evaluated after a (short) pause..."</span>)
  <span class="kw">Sys.sleep</span>(1L)
  <span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">"%H:%M:%OS6"</span>)
}

<span class="st">"foo"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">timestamp =</span> <span class="st">"timestamp"</span>
) %provides%<span class="st"> </span>{
  <span class="st">"foo"</span>
}
<span class="co">#&gt; Warning: [2017-06-15T15:33:08 UTC] Possibly unused dependency: 'timestamp'.</span>

<span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foo"</span>))
<span class="co">#&gt; [2017-06-15T15:33:08 UTC] Evaluating #1/1 (layer #1/1): 'timestamp' ...</span>
<span class="co">#&gt; 'timestamp' is evaluated after a (short) pause...</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.023   0.000   1.024</span></code></pre></div>
<p>In this example, <code>timestamp</code> is evaluated even though it is not explicitely used by <code>foo</code>. It just computes a timestamp after a short pause, but it could be virtually very resource-consuming at make-time.</p>
<p>Let us re-define <code>timestamp</code> as a prototype:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"timestamp"</span> %provides%<span class="st"> </span>{
  <span class="co"># This is a prototype.</span>
  function() {
    <span class="kw">message</span>(<span class="st">"'timestamp' is evaluated after a (short) pause..."</span>)
    <span class="kw">Sys.sleep</span>(1L)
    <span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">"%H:%M:%OS6"</span>)
  }
}
<span class="co">#&gt; [2017-06-15T15:33:09 UTC] Re-defining 'timestamp' ... OK</span>

<span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foo"</span>))
<span class="co">#&gt; [2017-06-15T15:33:09 UTC] Evaluating #1/1 (layer #1/1): 'timestamp' ...</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.025   0.000   0.025</span></code></pre></div>
<p>Here, the evaluation consists of defining a function that pauses for a while and returns a timestamp, only when the function is explicitely called. Even if the computation encapsulated by the function is very resource-consuming, no evaluation of the returned function takes place at make-time.</p>
<p>Finally, let us re-define <code>timestamp</code> as a memoised module:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"timestamp"</span> %provides%<span class="st"> </span>{
  <span class="co"># This is a memoised module.</span>
  memoise::<span class="kw">memoise</span>(
    function() {
      <span class="kw">message</span>(<span class="st">"'timestamp' is evaluated after a (short) pause..."</span>)
      <span class="kw">Sys.sleep</span>(1L)
      <span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">"%H:%M:%OS6"</span>)
    }
  )
}
<span class="co">#&gt; [2017-06-15T15:33:09 UTC] Re-defining 'timestamp' ... OK</span>

<span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foo"</span>))
<span class="co">#&gt; [2017-06-15T15:33:09 UTC] Evaluating #1/1 (layer #1/1): 'timestamp' ...</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.025   0.000   0.026</span></code></pre></div>
<p>The <code>timestamp</code> module returns a function which will be evaluated only when explicitely called at run-time. Let us re-define <code>foo</code> in order that it effectively uses <code>timestamp</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"foo"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">timestamp =</span> <span class="st">"timestamp"</span>
) %provides%<span class="st"> </span>{
  <span class="kw">message</span>(<span class="st">"It is "</span>, <span class="kw">timestamp</span>())
  <span class="st">"foo"</span>
}
<span class="co">#&gt; [2017-06-15T15:33:09 UTC] Re-defining 'foo' ... OK</span>

<span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foo"</span>))
<span class="co">#&gt; 'timestamp' is evaluated after a (short) pause...</span>
<span class="co">#&gt; It is 15:33:10.499974</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.026   0.000   1.026</span></code></pre></div>
<p>Here, a timestamped message is outputed. Let us force the re-evaluation of <code>foo</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/touch.html">touch</a></span>(<span class="st">"foo"</span>)
<span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foo"</span>))
<span class="co">#&gt; It is 15:33:10.499974</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.023   0.000   0.023</span></code></pre></div>
<p>The memoised version of <code>timestamp</code> is evaluated only at run-time, not at make-time; moreover, the string containing the actual timestamp is computed only once and then cached for future calls, avoiding re-evaluation.</p>
<p>To force re-evaluation of the memoised function exposed by <code>timestamp</code>, use <code>memoise::forget</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">memoise::<span class="kw">forget</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"timestamp"</span>))
<span class="co">#&gt; [1] TRUE</span>
<span class="kw"><a href="../reference/touch.html">touch</a></span>(<span class="st">"foo"</span>)
<span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foo"</span>))
<span class="co">#&gt; 'timestamp' is evaluated after a (short) pause...</span>
<span class="co">#&gt; It is 15:33:11.690977</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.024   0.000   1.023</span></code></pre></div>
</div>
<div id="lists" class="section level3">
<h3 class="hasAnchor">
<a href="#lists" class="anchor"></a>Lists</h3>
<p>It is often useful for a module to expose several (immutable, cf. infra) objects at once by returning a list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"timestamps"</span> %provides%<span class="st"> </span>{
  now &lt;-<span class="st"> </span>function() <span class="kw">Sys.time</span>()
  <span class="kw">list</span>(
    <span class="dt">origin =</span> <span class="kw">structure</span>(0L, <span class="dt">class =</span> <span class="st">"Date"</span>),
    <span class="dt">yesterday =</span> function() <span class="kw">now</span>() -<span class="st"> </span>86400L,
    <span class="dt">now =</span> now,
    <span class="dt">tomorrow =</span> function() <span class="kw">now</span>() +<span class="st"> </span>86400L
  )
}
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] Defining 'timestamps' ... OK</span>

ts %&lt;=%<span class="st"> "timestamps"</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] Making 'timestamps' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] DONE ('timestamps')</span>

ts$origin
<span class="co">#&gt; [1] "1970-01-01"</span>
ts$<span class="kw">yesterday</span>()
<span class="co">#&gt; [1] "2017-06-14 15:33:11 UTC"</span>
ts$<span class="kw">now</span>()
<span class="co">#&gt; [1] "2017-06-15 15:33:11 UTC"</span>
ts$<span class="kw">tomorrow</span>()
<span class="co">#&gt; [1] "2017-06-16 15:33:11 UTC"</span></code></pre></div>
</div>
<div id="environments" class="section level3">
<h3 class="hasAnchor">
<a href="#environments" class="anchor"></a>Environments</h3>
<p>It is often useful for a module to expose several mutable objects at once by returning an environment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"configuration"</span> %provides%<span class="st"> </span>{
  env &lt;-<span class="st"> </span><span class="kw">new.env</span>(<span class="dt">parent =</span> <span class="kw">emptyenv</span>())
  env$shape &lt;-<span class="st"> "circle"</span>
  env$color &lt;-<span class="st"> "blue"</span>
  env$size &lt;-<span class="st"> </span>13L
  env
}
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] Defining 'configuration' ... OK</span>

config %&lt;=%<span class="st"> "configuration"</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] Making 'configuration' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] DONE ('configuration')</span>

config$color
<span class="co">#&gt; [1] "blue"</span>
config$color &lt;-<span class="st"> "red"</span>
config$color
<span class="co">#&gt; [1] "red"</span></code></pre></div>
<p>This kind of module can be used to share mutable data between modules, without polluting the Global Environment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"widget_A"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">config =</span> <span class="st">"configuration"</span>
) %provides%<span class="st"> </span>{
  <span class="kw">list</span>(
    <span class="dt">switch_color =</span> function()
      config$color &lt;-<span class="st"> </span>if (config$color ==<span class="st"> "blue"</span>) <span class="st">"red"</span> else <span class="st">"blue"</span>
  )
}
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] Defining 'widget_A' ... OK</span>

<span class="st">"widget_B"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">config =</span> <span class="st">"configuration"</span>
) %provides%<span class="st"> </span>{
  <span class="kw">list</span>(
    <span class="dt">switch_shape =</span> function()
      config$shape &lt;-<span class="st"> </span>if (config$shape ==<span class="st"> "circle"</span>) <span class="st">"square"</span> else <span class="st">"circle"</span>
  )
}
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] Defining 'widget_B' ... OK</span>

widget_A %&lt;=%<span class="st"> "widget_A"</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] Making 'widget_A' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] DONE ('widget_A')</span>
widget_B %&lt;=%<span class="st"> "widget_B"</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] Making 'widget_B' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] DONE ('widget_B')</span>

widget_A$<span class="kw">switch_color</span>()
config$color
<span class="co">#&gt; [1] "blue"</span>

widget_B$<span class="kw">switch_shape</span>()
config$shape
<span class="co">#&gt; [1] "square"</span></code></pre></div>
<p>The modulr package implements the dedicated syntactic sugar <code>%provides_options%</code> for this frequent purpose.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/undefine.html">undefine</a></span>(<span class="st">"configuration"</span>)
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] Undefining 'configuration' ... OK</span>

<span class="st">"configuration"</span> %provides_options%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">shape =</span> <span class="st">"circle"</span>,
  <span class="dt">color =</span> <span class="st">"blue"</span>,
  <span class="dt">size =</span> 13L
)
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] Defining 'configuration' ... OK</span>

config %&lt;=%<span class="st"> "configuration"</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] Making 'configuration' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] DONE ('configuration')</span>
widget_A %&lt;=%<span class="st"> "widget_A"</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] Making 'widget_A' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] DONE ('widget_A')</span>

config$color
<span class="co">#&gt; [1] "blue"</span>
widget_A$<span class="kw">switch_color</span>()
config$color
<span class="co">#&gt; [1] "red"</span></code></pre></div>
</div>
</div>
<div id="semantic-versioning-semver" class="section level2">
<h2 class="hasAnchor">
<a href="#semantic-versioning-semver" class="anchor"></a>Semantic Versioning (SemVer)</h2>
<p>The modulr package offers <a href="http://semver.org">Semantic Versioning</a> capabilities: every module can live in several versions numbers of the form <code>x.y.z</code>, where <em>x</em>, <em>y</em>, and <em>z</em> are the <strong>major</strong>, <strong>minor</strong>, and <strong>patch</strong> versions, respectively. For instance, <code>foo#1.2.3</code> designates module <em>foo</em> in version <em>1.2.3</em>.</p>
<p>Given a version number, increment the:</p>
<ul>
<li>
<strong>major</strong> version when you make incompatible changes,</li>
<li>
<strong>minor</strong> version when you refactor and/or add functionality in a backwards-compatible manner, and</li>
<li>
<strong>patch</strong> version when you make backwards-compatible bug fixes.</li>
</ul>
<p>For instance, <code>foo#1.2.3</code> becomes <code>foo#1.2.4</code> after a bug fix and <code>foo#1.3.0</code> after a functionality bump.</p>
<p>Use:</p>
<ul>
<li>
<code>~x.y.z</code> to refer to the most up-to-date available patch version above <em>x.y.z</em> and <strong>allow bug fixes, but nothing else</strong>,</li>
<li>
<code>^x.y.z</code> or <code>^x.y</code> to refer to the most up-to-date available minor version above <em>x.y</em> and <strong>allow bug fixes and new functionalites, but nothing else</strong>, and</li>
<li>
<code>&gt;=x.y.z</code>, <code>&gt;=x.y</code>, or <code>&gt;=x</code> to refer to the most up-to-date version above <em>x.y.z</em>, <em>x.y</em>, or <em>x</em>, and <strong>live on the edge of developpments</strong>.</li>
</ul>
<p>Here are some examples among <code>foo#1.2.3</code>, <code>foo#1.2.4</code>, <code>foo#1.3.0</code>:</p>
<ul>
<li>
<code>foo#~1.2.0</code> refers to <code>foo#1.2.4</code>,</li>
<li>
<code>foo#~1.2.5</code> refers to nothing,</li>
<li>
<code>foo#^1.2.5</code> and <code>foo#^1.1</code> refer to <code>foo#1.3.0</code>,</li>
<li>
<code>foo#^1.3.1</code> and <code>foo#^1.4</code> refer to nothing, and</li>
<li>
<code>foo#&gt;=1.1.0</code>, <code>foo#&gt;=1.5</code>, and <code>foo#&gt;=0</code> (aka <em>latest</em>) refer to <code>foo#1.3.0</code>.</li>
</ul>
<div id="initial-scenario-no-versioning" class="section level3">
<h3 class="hasAnchor">
<a href="#initial-scenario-no-versioning" class="anchor"></a>Initial scenario: no versioning</h3>
<p>There is a good chance that your initial scenario contains no versioned module.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"great_module"</span> %provides%<span class="st"> </span>{
  function() {
    <span class="kw">Sys.sleep</span>(1L)
    <span class="st">"great features"</span>
  }
}
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] Defining 'great_module' ... OK</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"complex_module"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">great =</span> <span class="st">"great_module"</span>
) %provides%<span class="st"> </span>{
  function() <span class="kw">cat</span>(<span class="kw">paste</span>(<span class="st">"complex module using"</span>, <span class="kw">great</span>()))
}
<span class="co">#&gt; [2017-06-15T15:33:11 UTC] Defining 'complex_module' ... OK</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"complex_module"</span>)())
<span class="co">#&gt; [2017-06-15T15:33:12 UTC] Making 'complex_module' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:12 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:12 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:12 UTC] * Evaluating #1/1 (layer #1/1): 'great_module' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:12 UTC] DONE ('complex_module')</span>
<span class="co">#&gt; complex module using great features</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.024   0.000   1.025</span></code></pre></div>
<p>In this scenario, <code>great_module</code> does what it is supposed to do, but clearly not very efficiently. You then decide to work on a new version that improves its performance.</p>
</div>
<div id="setting-up-versioning" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-up-versioning" class="anchor"></a>Setting-up versioning</h3>
<p>First, we clone <code>great_module</code> with an initial version number.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"great_module#0.1.0"</span> %clones%<span class="st"> "great_module"</span>
<span class="co">#&gt; [2017-06-15T15:33:13 UTC] Defining 'great_module#0.1.0' ... OK</span></code></pre></div>
<p>We then adapt the requirements where <code>great_module</code> is injected as a dependency: for <code>complex_module</code>, we decide to accept bug fixes, refactorisations, and new functionalities, as long as the API does not change in an incompatible backward manner.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"complex_module"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">great =</span> <span class="st">"great_module#^0.1.0"</span>
) %provides%<span class="st"> </span>{
  function() <span class="kw">cat</span>(<span class="kw">paste</span>(<span class="st">"complex module using"</span>, <span class="kw">great</span>()))
}
<span class="co">#&gt; [2017-06-15T15:33:13 UTC] Re-defining 'complex_module' ... OK</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"complex_module"</span>)())
<span class="co">#&gt; [2017-06-15T15:33:13 UTC] Making 'complex_module' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:13 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:13 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:13 UTC] * Evaluating #1/1 (layer #1/1): 'great_module#0.1.0' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:13 UTC] DONE ('complex_module')</span>
<span class="co">#&gt; complex module using great features</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.031   0.001   1.033</span></code></pre></div>
<p>Here is the minor bump of <code>great_module</code>, which is a little bit more efficient.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"great_module#0.2.0"</span> %provides%<span class="st"> </span>{
  <span class="co"># Improved internals, same interface</span>
  function() <span class="st">"great optimisd features"</span>
}
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] Defining 'great_module#0.2.0' ... OK</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"complex_module"</span>)())
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] Making 'complex_module' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] * Evaluating #1/1 (layer #1/1): 'great_module#0.2.0' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] DONE ('complex_module')</span>
<span class="co">#&gt; complex module using great optimisd features</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.033   0.000   0.033</span></code></pre></div>
<p>And here is the latest bug fix correcting the typo.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"great_module#0.2.1"</span> %provides%<span class="st"> </span>{
  <span class="co"># Bug fix</span>
  function() <span class="st">"great optimised features"</span>
}
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] Defining 'great_module#0.2.1' ... OK</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"complex_module"</span>)()
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] Making 'complex_module' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] * Evaluating #1/1 (layer #1/1): 'great_module#0.2.1' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] DONE ('complex_module')</span>
<span class="co">#&gt; complex module using great optimised features</span></code></pre></div>
</div>
</div>
<div id="location-of-modules" class="section level2">
<h2 class="hasAnchor">
<a href="#location-of-modules" class="anchor"></a>Location of modules</h2>
<p>Modules can be defined in several locations: in-memory, on-disk in its own file or along another module’s file, and remotely on GitHub’s Gist or via the HTTP(S) protocol.</p>
<div id="in-memory" class="section level3">
<h3 class="hasAnchor">
<a href="#in-memory" class="anchor"></a>In-memory</h3>
<p>This is the most direct method to define a module. This is also the most volatile, since the lifespan of the module is limited to the R session.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"foo"</span> %provides%<span class="st"> "bar"</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] Defining 'foo' ... OK</span>
<span class="kw"><a href="../reference/list_modules.html">lsmod</a></span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">"name"</span>, <span class="st">"storage"</span>, <span class="st">"along"</span>, <span class="st">"filepath"</span>, <span class="st">"url"</span>))
<span class="co">#&gt;   name   storage along filepath  url</span>
<span class="co">#&gt; 1  foo in-memory  &lt;NA&gt;     &lt;NA&gt; &lt;NA&gt;</span></code></pre></div>
</div>
<div id="on-disk" class="section level3">
<h3 class="hasAnchor">
<a href="#on-disk" class="anchor"></a>On-disk</h3>
<p>This is the way to go when a module is intended to be reused. In such a case, the definition takes place in a dedicated R, R Markdown, or R Sweave file, which path and name are closely related to the module’s name.</p>
<p>For instance, the following module definition is stored in the R file <code>swissknife.R</code>, under the sub-directory <code>vendor/tool</code> of the <code>./modules</code> directory.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># File: modules/vendor/tool/swissknife.R</span>

<span class="kw">library</span>(modulr)

<span class="st">"vendor/tool/swissknife"</span> %provides%<span class="st"> </span>{
  <span class="kw">list</span>(
    <span class="dt">large_blade =</span> <span class="st">"Large blade"</span>,
    <span class="dt">small_blade =</span> <span class="st">"Small blade"</span>,
    <span class="dt">scissors =</span> <span class="st">"Scissors"</span>,
    <span class="dt">led_light =</span> <span class="st">"LED light"</span>
  )
}</code></pre></div>
<p>When a module is invoked, modulr searches for it in-memory first, then on-disk if necessary. There are several default <strong>root</strong> places where modulr looks for the module’s file: <code>./modules/</code>, <code>./module/</code>, <code>./libs/</code>, <code>./lib/</code>, and <code>./</code>. This behaviour can be configured with the help of <code>root_config</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">root_config$<span class="kw"><a href="../reference/config.html">get_all</a></span>()
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] "modules" "module"  "libs"    "lib"     "."</span></code></pre></div>
<p>This explains why modulr finds the module <code>vendor/tool/swissknife</code> under the file <code>./modules/vendor/tool/swissknife.R</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_swissknife %&lt;=%<span class="st"> "vendor/tool/swissknife"</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] Making 'vendor/tool/swissknife' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] ** Defining 'vendor/tool/swissknife' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] DONE ('vendor/tool/swissknife')</span></code></pre></div>
<p>This also works with R Markdown <code>.Rmd</code> and R Sweave <code>.Rnw</code> files.</p>
<pre><code>&lt;!--- File: modules/vendor/tool/multitool.Rmd --&gt;

# Module `vendor/tool/multitool`

```{r}
library(modulr)

"vendor/tool/multitool" %provides% {
  list(
    pliers = "Pliers",
    keychain = "Keychain"
  )
}
```</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/load_module.html">load_module</a></span>(<span class="st">"vendor/tool/multitool"</span>) <span class="co"># load only, do not make</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] Defining 'vendor/tool/multitool' ... OK</span>
<span class="co">#&gt;               vendor/tool/multitool </span>
<span class="co">#&gt; "modules/vendor/tool/multitool.Rmd"</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/list_modules.html">lsmod</a></span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">"name"</span>, <span class="st">"storage"</span>, <span class="st">"along"</span>, <span class="st">"filepath"</span>, <span class="st">"url"</span>))
<span class="co">#&gt;                     name storage along                          filepath</span>
<span class="co">#&gt; 1  vendor/tool/multitool on-disk  &lt;NA&gt; modules/vendor/tool/multitool.Rmd</span>
<span class="co">#&gt; 2 vendor/tool/swissknife on-disk  &lt;NA&gt;  modules/vendor/tool/swissknife.R</span>
<span class="co">#&gt;    url</span>
<span class="co">#&gt; 1 &lt;NA&gt;</span>
<span class="co">#&gt; 2 &lt;NA&gt;</span></code></pre></div>
<p>Along a principal module, it is possible to define other related modules, for instance mock-ups and testing modules (cf. infra).</p>
</div>
<div id="remote-modulr-gears" class="section level3">
<h3 class="hasAnchor">
<a href="#remote-modulr-gears" class="anchor"></a>Remote (<em>modulr gears</em>)</h3>
<p>Using GitHub’s <a href="https://gist.github.com">Gist</a> is a simple way to share modules with others. To illustrate this, let us consider the following remote module, aka <strong>modulr gear</strong>: <a href="https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3" class="uri">https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"modulr/vault"</span> %imports%<span class="st"> "https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3"</span>
<span class="co">#&gt; [2017-06-15T15:33:14 UTC] Importing 'modulr/vault' from gist ID '3fcc508cb40ddac6c1e3' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:15 UTC] * Found 1 file(s) with R flavour (see https://gist.github.com/3fcc508cb40ddac6c1e3).</span>
<span class="co">#&gt; [2017-06-15T15:33:15 UTC] * Installing gear at 'gears/modulr/vault/36aac0cbf56b3873'.</span>
<span class="co">#&gt; [2017-06-15T15:33:15 UTC] DONE ('modulr/vault')</span>
<span class="co">#&gt; [2017-06-15T15:33:15 UTC] Defining 'modulr/vault/example_SECRET_' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:15 UTC] Defining 'modulr/vault/example' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:15 UTC] Defining 'modulr/vault#0.1.0' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:15 UTC] Defining 'modulr/vault#0.1.0/mock' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:15 UTC] Defining 'modulr/vault#0.1.0/test' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:15 UTC] Digest of 'modulr/vault#0.1.0' is '390032bb2476c24e'.</span></code></pre></div>
<p>Notice that only specifiying the gist ID in <code>"modulr/vault" %imports% "3fcc508cb40ddac6c1e3"</code> has the same effect. It is possible to import modules from any URL using the HTTP(S) protocol.</p>
<p>Once imported, a remote module appears to be in-memory defined.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/list_modules.html">lsmod</a></span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">"name"</span>, <span class="st">"storage"</span>, <span class="st">"along"</span>, <span class="st">"filepath"</span>, <span class="st">"url"</span>))
<span class="co">#&gt;                           name   storage              along</span>
<span class="co">#&gt; 1         modulr/vault/example in-memory modulr/vault#0.1.0</span>
<span class="co">#&gt; 2 modulr/vault/example_SECRET_ in-memory modulr/vault#0.1.0</span>
<span class="co">#&gt; 3           modulr/vault#0.1.0 in-memory               &lt;NA&gt;</span>
<span class="co">#&gt; 4      modulr/vault#0.1.0/mock in-memory modulr/vault#0.1.0</span>
<span class="co">#&gt; 5      modulr/vault#0.1.0/test in-memory modulr/vault#0.1.0</span>
<span class="co">#&gt;           filepath                                                   url</span>
<span class="co">#&gt; 1 modulr-vault.Rmd https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3</span>
<span class="co">#&gt; 2 modulr-vault.Rmd https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3</span>
<span class="co">#&gt; 3 modulr-vault.Rmd https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3</span>
<span class="co">#&gt; 4 modulr-vault.Rmd https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3</span>
<span class="co">#&gt; 5 modulr-vault.Rmd https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3</span></code></pre></div>
<p>To use a remote module as a dependency, just import it where needed (even in a remote module).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"modulr/vault"</span> %imports%<span class="st"> "3fcc508cb40ddac6c1e3"</span>

<span class="st">"module/using/a/gear"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">vault =</span> <span class="st">"modulr/vault"</span>
) %provides%<span class="st"> </span>{
  vault$<span class="kw">decrypt</span>(
    <span class="dt">secret =</span> <span class="st">"TWUnCkRAlP70XvmRlnAFrw=="</span>,
    <span class="dt">key =</span> <span class="st">"EaJWzAZjjphu9CoA+MPUVCL8mmMAGp0j6Nbga29kV/A="</span>)
}
<span class="co">#&gt; [2017-06-15T15:33:15 UTC] Defining 'module/using/a/gear' ... OK</span>

<span class="kw"><a href="../reference/make.html">make</a></span>()
<span class="co">#&gt; [2017-06-15T15:33:15 UTC] Making 'module/using/a/gear' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:15 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:15 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:15 UTC] * Evaluating #1/1 (layer #1/1): 'modulr/vault#0.1.0' ...</span>
<span class="co">#&gt; Loading required package: base64enc</span>
<span class="co">#&gt; [2017-06-15T15:33:15 UTC] DONE ('module/using/a/gear')</span>
<span class="co">#&gt; [1] "passw0rd"</span></code></pre></div>
<p>Notice that sharing a module is as easy as sending this one-liner code snippet:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(modulr); <span class="st">"modulr/vault#^0.1.0"</span> %imports%<span class="st"> "3fcc508cb40ddac6c1e3"</span></code></pre></div>
<p>Finally, private Gists and <a href="https://enterprise.github.com">GitHub Enterprise</a> users are also covered, thanks to GitHub’s <a href="https://github.com/blog/1509-personal-api-tokens">Personal Access Tokens</a> (PAT). For instance, with the GitHub Enterprise instance of the University of Lausanne:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Set 'GITHUB_PAT' in your '.Renviron' file or right here:</span>
<span class="co"># Sys.setenv(GITHUB_PAT = "Your Personal Access Token here")</span>

<span class="st">"modulr/private_GitHubEnterprise_module"</span> %imports%<span class="st"> </span>
<span class="st">  "https://github.unil.ch/api/v3/gists/1afa4770670975d70806c2153aac50a9"</span></code></pre></div>
<pre><code>#&gt; [2017-06-15T15:33:15 UTC] Importing 'modulr/private_GitHubEnterprise_module' from gist ID '1afa4770670975d70806c2153aac50a9' (endpoint 'https://github.unil.ch/api/v3') ...
#&gt; [2017-06-15T15:33:15 UTC] * Found 1 file(s) with R flavour (see https://github.unil.ch/gist/1afa4770670975d70806c2153aac50a9).
#&gt; [2017-06-15T15:33:15 UTC] * Installing gear at 'gears/modulr/private_GitHubEnterprise_module/ee79eba8a1102448'.
#&gt; [2017-06-15T15:33:15 UTC] DONE ('modulr/private_GitHubEnterprise_module')
#&gt; [2017-06-15T15:33:15 UTC] Defining 'modulr/private_GitHubEnterprise_module' ... OK
#&gt; [2017-06-15T15:33:15 UTC] Digest of 'modulr/private_GitHubEnterprise_module' is 'efbb8ee38858aaef'.</code></pre>
<p>Let us assume that the following module is worth publishing:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"modulr/release_gist_example"</span> %provides%<span class="st"> "Hello World!"</span></code></pre></div>
<p>To release this module as a modulr gear on GitHub’s Gist, simply use <code>release_gear_as_gist</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/release_gear_as_gist.html">release_gear_as_gist</a></span>()</code></pre></div>
<pre><code>#&gt; [2017-06-15T15:33:15 UTC] Updating 'modulr-release_gist_example.Rmd' in gist ID '91ffa1950571b67d476131873a8a069b'.
#&gt; [2017-06-15T15:33:16 UTC] No changes found for 'modulr-release_gist_example.Rmd' in gist ID '91ffa1950571b67d476131873a8a069b'.</code></pre>
<p>The module is then publicly available here: <a href="https://gist.github.com/91ffa1950571b67d476131873a8a069b" class="uri">https://gist.github.com/91ffa1950571b67d476131873a8a069b</a>.</p>
</div>
</div>
<div id="testing" class="section level2">
<h2 class="hasAnchor">
<a href="#testing" class="anchor"></a>Testing</h2>
<p>Testing is a very important aspect of programming and modulr is well-suited for this purpose.</p>
<div id="single-module" class="section level3">
<h3 class="hasAnchor">
<a href="#single-module" class="anchor"></a>Single module</h3>
<p>Let us consider the following module, exposing a function which computes the first terms of the infinite sequence of powers of <span class="math inline">\(2\)</span>: <span class="math inline">\(2^0=1\)</span>, <span class="math inline">\(2^1=2\)</span>, <span class="math inline">\(2^2=4\)</span>, <span class="math inline">\(2^3=8\)</span>, etc.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"powers_of_2"</span> %provides%<span class="st"> </span>{
  function(<span class="dt">terms =</span> 10L) {
    2L ^<span class="st"> </span>(<span class="kw">seq_len</span>(terms) -<span class="st"> </span>1L)
  }
}
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] Defining 'powers_of_2' ... OK</span></code></pre></div>
<p>For all <span class="math inline">\(n\geq1\)</span>, let <span class="math inline">\((x_1, ..., x_n)\)</span> the sequence consisting of the first <span class="math inline">\(n\)</span> powers of <span class="math inline">\(2\)</span>. Let us suppose that we want to perform elementary tests on some of these sequences: a. <span class="math inline">\(x_1=1\)</span>, b. <span class="math inline">\(x_n=2^{n-1}\)</span>, and c. <span class="math inline">\(x_{i+1} = 2x_i\)</span> for all <span class="math inline">\(1\leq i\leq n-1\)</span>.</p>
<p>Let us then define <code>powers_of_2/test</code>, a dedicated module for testing <code>powers_of_2</code> using Hadley Wickham’s <a href="https://github.com/hadley/testthat">testthat</a> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"powers_of_2/test"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">powers_of_2 =</span> <span class="st">"powers_of_2"</span>
) %provides%<span class="st"> </span>{
  <span class="kw">library</span>(testthat)
  <span class="kw">test_that</span>(<span class="st">"First term is 1"</span>, {
    for (terms in <span class="kw">sample</span>(1L:50L, 3L, <span class="dt">replace =</span> <span class="ot">FALSE</span>)) {
      <span class="kw">expect_equal</span>(
        <span class="kw">powers_of_2</span>(terms)[1L],
        1L
      )
    }
  })
  <span class="kw">test_that</span>(<span class="st">"Last term is as expected"</span>, {
    for (terms in <span class="kw">sample</span>(1L:50L, 3L, <span class="dt">replace =</span> <span class="ot">FALSE</span>)) {
      <span class="kw">expect_equal</span>(
        <span class="kw">tail</span>(<span class="kw">powers_of_2</span>(terms), 1L),
        2L ^<span class="st"> </span>(terms -<span class="st"> </span>1L)
      )
    }
  })
  <span class="kw">test_that</span>(<span class="st">"Any two consecutive terms are as expected"</span>, {
    for (terms in <span class="kw">sample</span>(2L:50L, 3L, <span class="dt">replace =</span> <span class="ot">FALSE</span>)) {
      series &lt;-<span class="st"> </span><span class="kw">powers_of_2</span>(terms)
      for (index in <span class="kw">sample</span>(1L:(terms -<span class="st"> </span>1L), <span class="kw">min</span>(10L, (terms -<span class="st"> </span>1L)), 
                           <span class="dt">replace =</span> <span class="ot">FALSE</span>)) {
        <span class="kw">expect_equal</span>(series[index] *<span class="st"> </span><span class="dv">2</span>, series[index +<span class="st"> </span>1L])
      }
    }
  })
}
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] Defining 'powers_of_2/test' ... OK</span></code></pre></div>
<p>In order to run the tests, it is sufficient to evaluate this module.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"powers_of_2/test"</span>)
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] Making 'powers_of_2/test' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] * Evaluating #1/1 (layer #1/1): 'powers_of_2' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] DONE ('powers_of_2/test')</span></code></pre></div>
<p>It is also possible to run all available tests.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make.html">make_tests</a></span>()
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] Making 'powers_of_2/test' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] DONE ('powers_of_2/test')</span>
<span class="co">#&gt; PASSED.</span></code></pre></div>
<p>To illustrate the situation where some test fails, let us consider a faulty version of <code>powers_of_2</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"powers_of_2"</span> %provides%<span class="st"> </span>{
  function(<span class="dt">terms =</span> 10L) {
    sequence &lt;-<span class="st"> </span>2L ^<span class="st"> </span>(<span class="kw">seq_len</span>(terms) -<span class="st"> </span>1L)
    <span class="co"># This is a faulty version.</span>
    sequence[1L] &lt;-<span class="st"> </span>0L
  }
}
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] Re-defining 'powers_of_2' ... OK</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">try</span>(<span class="kw"><a href="../reference/make.html">make_tests</a></span>())
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] Making 'powers_of_2/test' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] * Evaluating #1/1 (layer #1/1): 'powers_of_2' ...</span>
<span class="co">#&gt; Error: Test failed: 'First term is 1'</span>
<span class="co">#&gt; * powers_of_2(terms)[1L] not equal to 1.</span>
<span class="co">#&gt; 1/1 mismatches</span>
<span class="co">#&gt; [1] 0 - 1 == -1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; * powers_of_2(terms)[1L] not equal to 1.</span>
<span class="co">#&gt; 1/1 mismatches</span>
<span class="co">#&gt; [1] 0 - 1 == -1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; * powers_of_2(terms)[1L] not equal to 1.</span>
<span class="co">#&gt; 1/1 mismatches</span>
<span class="co">#&gt; [1] 0 - 1 == -1</span></code></pre></div>
</div>
<div id="module-with-mocked-dependencies" class="section level3">
<h3 class="hasAnchor">
<a href="#module-with-mocked-dependencies" class="anchor"></a>Module with <em>mocked</em> dependencies</h3>
<p>Let us consider the following module, which relies on RStudio’s <a href="https://github.com/metacran/cranlogs">cranlogs</a> package to request the list of top downloaded packages from their CRAN mirror.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"get_top_downloads"</span> %provides%<span class="st"> </span>{
  <span class="kw">library</span>(cranlogs)
  function(<span class="dt">when =</span> <span class="st">"last-week"</span>, <span class="dt">count =</span> 100L) {
    <span class="kw">cran_top_downloads</span>(<span class="dt">when =</span> when, <span class="dt">count =</span> count)
  }
}</code></pre></div>
<p>The following module uses Hadley Wickham’s <a href="https://github.com/tidyverse/ggplot2">ggplot2</a> package to plot the list of top downloaded packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"plot_top_downloads"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">get_top_downloads =</span> <span class="st">"get_top_downloads"</span>
) %provides%<span class="st"> </span>{
  <span class="kw">library</span>(ggplot2)
  function(<span class="dt">when =</span> <span class="st">"last-week"</span>, <span class="dt">count =</span> 10L) {
    top_downloads &lt;-<span class="st"> </span><span class="kw">get_top_downloads</span>(<span class="dt">when =</span> when, <span class="dt">count =</span> count)

    <span class="kw">ggplot</span>(<span class="dt">data =</span> top_downloads, 
           <span class="kw">aes</span>(<span class="dt">x =</span> top_downloads$package, <span class="dt">y =</span> top_downloads$count)) +<span class="st"> </span>
<span class="st">      </span><span class="kw">theme_light</span>() +<span class="st"> </span>
<span class="st">      </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="fl">90.0</span>, <span class="dt">hjust =</span> <span class="fl">1.0</span>)) +<span class="st"> </span>
<span class="st">      </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>) +<span class="st"> </span>
<span class="st">      </span><span class="kw">scale_x_discrete</span>(<span class="dt">limits =</span> top_downloads$package) +
<span class="st">      </span><span class="kw">labs</span>(
        <span class="dt">title =</span> <span class="kw">sprintf</span>(
          <span class="st">"Top %d Downloads (%s, RStudio's CRAN mirror)"</span>, 
          count,
          <span class="kw">format</span>(<span class="kw">unique</span>(top_downloads$to), <span class="dt">format =</span> <span class="st">"%Y-%m-%d"</span>)), 
        <span class="dt">x =</span> <span class="st">"Package"</span>, <span class="dt">y =</span> <span class="st">"Count"</span>)
    
  }
}
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] Defining 'plot_top_downloads' ... OK</span>

plot_top_downloads %&lt;=%<span class="st"> "plot_top_downloads"</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] Making 'plot_top_downloads' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] * Evaluating #1/1 (layer #1/1): 'get_top_downloads' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] DONE ('plot_top_downloads')</span>

<span class="kw">plot_top_downloads</span>()</code></pre></div>
<p><img src="figures/modulr-plot-top-downloads-1.png" width="90%" style="display: block; margin: auto;"></p>
<p>Testing this module directly would require to be connected on the internet and would stress the RStudio’s remote API, which is very bad practice. In order to avoid such prohibited behaviour, it is recommended to define new modules that <em>mock</em> the original functionalities.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"get_top_downloads/mock"</span> %provides%<span class="st"> </span>{
  <span class="kw">library</span>(tibble)
  function(...) {
    <span class="kw">tribble</span>(
      ~rank, ~package, ~count, ~from, ~to,
      1L, <span class="st">"Rcpp"</span>, 105000L, <span class="kw">as.Date</span>(<span class="st">"2017-05-05"</span>), <span class="kw">as.Date</span>(<span class="st">"2017-05-11"</span>),
      2L, <span class="st">"ggplot2"</span>, 100000L, <span class="kw">as.Date</span>(<span class="st">"2017-05-05"</span>), <span class="kw">as.Date</span>(<span class="st">"2017-05-11"</span>),
      3L, <span class="st">"tibble"</span>, 90000L, <span class="kw">as.Date</span>(<span class="st">"2017-05-05"</span>), <span class="kw">as.Date</span>(<span class="st">"2017-05-11"</span>)
    )
  }
}
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] Defining 'get_top_downloads/mock' ... OK</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"plot_top_downloads/mock"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">get_top_downloads =</span> <span class="st">"get_top_downloads/mock"</span>
) %provides%<span class="st"> </span><span class="kw"><a href="../reference/get_provider.html">get_provider</a></span>(<span class="st">"plot_top_downloads"</span>)
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] Defining 'plot_top_downloads/mock' ... OK</span></code></pre></div>
<p>Notice the use of <code><a href="../reference/get_provider.html">get_provider("plot_top_downloads")</a></code> in the second definition: <code>plot_top_downloads/mock</code> requires <code>get_top_downloads/mock</code>, a <em>mocked</em> version of <code>get_top_downloads</code>, but provides the same features as <code>plot_top_downloads</code>; change the definition of <code>plot_top_downloads</code> and it will change the definition of <code>plot_top_downloads/mock</code> at the same time.</p>
<p>Along the lines of the first example, you can then define a testing module.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"plot_top_downloads/test"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">plot_top_downloads =</span> <span class="st">"plot_top_downloads/mock"</span>
) %provides%<span class="st"> </span>{
  <span class="kw">library</span>(testthat)
  plot &lt;-<span class="st"> </span><span class="kw">plot_top_downloads</span>()
  <span class="kw">test_that</span>(<span class="st">"X-Axis is labelled 'Package'"</span>, {
    <span class="kw">expect_identical</span>(plot$labels$x, <span class="st">"Package"</span>)
  })
  <span class="kw">test_that</span>(<span class="st">"Y-Axis is labelled 'Count'"</span>, {
    <span class="kw">expect_identical</span>(plot$labels$y, <span class="st">"Count"</span>)
  })
  <span class="kw">test_that</span>(<span class="st">"Plot layers match expectations"</span>, {
    <span class="kw">expect_is</span>(plot$layers[[1L]], <span class="st">"ggproto"</span>)
    <span class="kw">expect_is</span>(plot$layers[[1L]]$geom, <span class="st">"GeomBar"</span>)
    <span class="kw">expect_is</span>(plot$layers[[1L]]$stat, <span class="st">"StatIdentity"</span>)
  })
}
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] Defining 'plot_top_downloads/test' ... OK</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make.html">make_tests</a></span>()
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] Making 'plot_top_downloads/test' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] * Sorting 2 dependencies with 2 relations ... on 2 layers, OK</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] * Evaluating new and outdated dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:16 UTC] ** Evaluating #1/2 (layer #1/2): 'get_top_downloads/mock' ...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'tibble'</span>
<span class="co">#&gt; The following object is masked from 'package:assertthat':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     has_name</span>
<span class="co">#&gt; The following objects are masked from 'package:dplyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     as_data_frame, data_frame, data_frame_, glimpse,</span>
<span class="co">#&gt;     knit_print.trunc_mat, trunc_mat, type_sum</span>
<span class="co">#&gt; [2017-06-15T15:33:17 UTC] ** Evaluating #2/2 (layer #2/2): 'plot_top_downloads/mock' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:17 UTC] DONE ('plot_top_downloads/test')</span>
<span class="co">#&gt; PASSED. You're #1.</span></code></pre></div>
<p>As a last example, it is considered a good practice to provide all <strong>modulr gears</strong> with appropriate tests, as illustrated by <a href="https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3" class="uri">https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"modulr/vault"</span> %imports%<span class="st"> "3fcc508cb40ddac6c1e3"</span>
<span class="co">#&gt; [2017-06-15T15:33:17 UTC] Importing 'modulr/vault' from gist ID '3fcc508cb40ddac6c1e3' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:17 UTC] * Using installed gear at 'gears/modulr/vault/36aac0cbf56b3873'.</span>
<span class="co">#&gt; [2017-06-15T15:33:17 UTC] DONE ('modulr/vault')</span>
<span class="co">#&gt; [2017-06-15T15:33:17 UTC] Defining 'modulr/vault/example_SECRET_' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:17 UTC] Defining 'modulr/vault/example' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:17 UTC] Defining 'modulr/vault#0.1.0' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:17 UTC] Defining 'modulr/vault#0.1.0/mock' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:17 UTC] Defining 'modulr/vault#0.1.0/test' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:17 UTC] Digest of 'modulr/vault#0.1.0' is '390032bb2476c24e'.</span>
<span class="kw"><a href="../reference/make.html">make_tests</a></span>()
<span class="co">#&gt; [2017-06-15T15:33:17 UTC] Making 'modulr/vault#0.1.0/test' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:17 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:17 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:17 UTC] * Evaluating #1/1 (layer #1/1): 'modulr/vault#0.1.0/mock' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:24 UTC] DONE ('modulr/vault#0.1.0/test')</span>
<span class="co">#&gt; PASSED.</span></code></pre></div>
</div>
</div>
<div id="special-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#special-variables" class="anchor"></a>Special variables</h2>
<div id="last-name" class="section level3">
<h3 class="hasAnchor">
<a href="#last-name" class="anchor"></a><code>.Last.name</code>
</h3>
<p>When a module is defined, touched, or made, its name is always assigned to <code>.Last.name</code>. The special variable <code>.Last.name</code> is also used as a default parameter for <code>make</code>, <code>touch</code>, and <code>undefine</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"foo"</span> %provides%<span class="st"> "bar"</span>
<span class="co">#&gt; [2017-06-15T15:33:24 UTC] Defining 'foo' ... OK</span>

.Last.name
<span class="co">#&gt; [1] "foo"</span>

<span class="kw"><a href="../reference/make.html">make</a></span>()
<span class="co">#&gt; [2017-06-15T15:33:24 UTC] Making 'foo' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:24 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:24 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:24 UTC] DONE ('foo')</span>
<span class="co">#&gt; [1] "bar"</span>

<span class="kw"><a href="../reference/touch.html">touch</a></span>()
<span class="co">#&gt; [2017-06-15T15:33:24 UTC] Touching 'foo' ... OK</span>

<span class="kw"><a href="../reference/undefine.html">undefine</a></span>()
<span class="co">#&gt; [2017-06-15T15:33:24 UTC] Undefining 'foo' ... OK</span></code></pre></div>
</div>
<div id="modules-metadata" class="section level3">
<h3 class="hasAnchor">
<a href="#modules-metadata" class="anchor"></a>Module’s metadata</h3>
<p>Every module has access to some of its metadata: name, version, file path (when on-disk), etc. The following module illustrates this feature and is self-explanatory.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># File: modules/my/great/module/reflection.R</span>

<span class="kw">library</span>(modulr)

<span class="st">"my/great/module/reflection#0.1.0"</span> %provides%<span class="st"> </span>{
  <span class="kw">list</span>(
    <span class="dt">.__name__ =</span> .__name__,
    <span class="dt">.__namespace__ =</span> .__namespace__,
    <span class="dt">.__initials__ =</span> .__initials__,
    <span class="dt">.__final__ =</span> .__final__,
    <span class="dt">.__version__ =</span> .__version__,
    <span class="dt">.__file__ =</span> .__file__,
    <span class="dt">.__path__ =</span> .__path__
  )
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/with_verbosity.html">with_verbosity</a></span>(0L, <span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"my/great/module/reflection"</span>))
<span class="co">#&gt; $.__name__</span>
<span class="co">#&gt; [1] "my/great/module/reflection#0.1.0"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $.__namespace__</span>
<span class="co">#&gt; [1] "my/great/module/reflection"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $.__initials__</span>
<span class="co">#&gt; [1] "my/great/module"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $.__final__</span>
<span class="co">#&gt; [1] "reflection"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $.__version__</span>
<span class="co">#&gt; [1] '0.1.0'</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $.__file__</span>
<span class="co">#&gt;                                                            my/great/module/reflection#0.1.0 </span>
<span class="co">#&gt; "/home/projects/aclemen1/RStudio/modulr/docs/articles/modules/my/great/module/reflection.R" </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $.__path__</span>
<span class="co">#&gt; [1] "/home/projects/aclemen1/RStudio/modulr/docs/articles/modules/my/great/module"</span></code></pre></div>
</div>
</div>
<div id="the-special-module-modulr" class="section level2">
<h2 class="hasAnchor">
<a href="#the-special-module-modulr" class="anchor"></a>The special module <code>modulr</code>
</h2>
<p>The modulr package defines a special module named <code>modulr</code> that can be injected in any module. The purpose of this special module is to give access to useful helper functions related to the module into which it is injected.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/print_info.html">info</a></span>(<span class="st">"modulr"</span>)
<span class="co">#&gt; # `modulr`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Access module helper functions.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The purpose of this special module is to give access to useful helper</span>
<span class="co">#&gt; functions related to the module into which it is injected.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ## Methods</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ### `post_evaluation_hook(expr, add = FALSE)`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Records the expression given as its argument as needing to be executed</span>
<span class="co">#&gt; when the current module evaluation exits (either naturally or as the</span>
<span class="co">#&gt; result of an error). If no expression is provided, i.e., the call is</span>
<span class="co">#&gt; `post_evaluation_hook()`, then the current expression is removed. If</span>
<span class="co">#&gt; `add` is `TRUE`, `expr` is added after any previously set expressions;</span>
<span class="co">#&gt; otherwise (the default) `expr` will overwrite any previously set</span>
<span class="co">#&gt; expressions.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ### `message_info(...)`, `message_warn(...)`, `message_stop(...)`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Outputs an informative, warning, or critical and stopping message,</span>
<span class="co">#&gt; prefixed with a timestamp and the module name. Such messages are</span>
<span class="co">#&gt; particularily useful in modules involved in long chains of dependencies</span>
<span class="co">#&gt; and workflows.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ## Deprecated methods</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ### `get_module_name()`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Returns a string (character vector of lenght one) containing the module</span>
<span class="co">#&gt; name. Deprecated and kept for backward compatibility. Use `.__name__`</span>
<span class="co">#&gt; instead.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ### `get_module_version()`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Returns the numeric version of the module. Deprecated and kept for</span>
<span class="co">#&gt; backward compatibility. Use `.__version__` instead.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ### `get_module_options()`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Returns a list containing the module options. Deprecated and kept for</span>
<span class="co">#&gt; backward compatibility.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ### `get_filename()`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Returns a string (character vector of lenght one) containing the module</span>
<span class="co">#&gt; filename. Deprecated and kept for backward compatibility. Use `.__path__`</span>
<span class="co">#&gt; and/or `.__file__` instead.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ### `get_dirname()`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Returns a string (character vector of lenght one) containing the module</span>
<span class="co">#&gt; dirname. Deprecated and kept for backward compatibility. Use `.__path__`</span>
<span class="co">#&gt; and/or `.__file__` instead.</span></code></pre></div>
<div id="messages" class="section level3">
<h3 class="hasAnchor">
<a href="#messages" class="anchor"></a>Messages</h3>
<p>TODO</p>
</div>
<div id="post-evaluation-hook" class="section level3">
<h3 class="hasAnchor">
<a href="#post-evaluation-hook" class="anchor"></a>Post-evaluation hook</h3>
<p>There are situations where a post-evaluation hook is needed. For instance, to define an ephemeral module that can be evaluated only once, or to define a so-called <em>no-scoped</em> module, which looks like a pure singleton, but behaves like a prototype.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"ephemeral"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">modulr =</span> <span class="st">"modulr"</span>
) %provides%<span class="st"> </span>{
  modulr$<span class="kw"><a href="../reference/modulr-module.html">post_evaluation_hook</a></span>(<span class="kw"><a href="../reference/undefine.html">undefine</a></span>(<span class="st">"ephemeral"</span>))
  <span class="st">"A butterfly"</span>
}
<span class="co">#&gt; [2017-06-15T15:33:25 UTC] Defining 'ephemeral' ... OK</span>

<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"ephemeral"</span>) <span class="co"># returns a butterfly</span>
<span class="co">#&gt; [2017-06-15T15:33:25 UTC] Making 'ephemeral' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:25 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:25 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:25 UTC] * Evaluating #1/1 (layer #1/1): 'modulr#0.1.7.9177' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:25 UTC] * Undefining 'ephemeral' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:25 UTC] DONE ('ephemeral')</span>
<span class="co">#&gt; [1] "A butterfly"</span>
<span class="kw">try</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"ephemeral"</span>), <span class="dt">silent =</span> <span class="ot">TRUE</span>) <span class="co"># no more</span>
<span class="co">#&gt; [2017-06-15T15:33:25 UTC] Making 'ephemeral' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:25 UTC] * Visiting and defining dependencies ...</span>
<span class="kw">cat</span>(<span class="kw">geterrmessage</span>())
<span class="co">#&gt; Error : "ephemeral" is not defined.</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"no_scoped"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">modulr =</span> <span class="st">"modulr"</span>
) %provides%<span class="st"> </span>{
  modulr$<span class="kw"><a href="../reference/modulr-module.html">post_evaluation_hook</a></span>(<span class="kw"><a href="../reference/touch.html">touch</a></span>(<span class="st">"no_scoped"</span>))
  <span class="kw">Sys.time</span>()
}
<span class="co">#&gt; [2017-06-15T15:33:25 UTC] Defining 'no_scoped' ... OK</span>

<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"no_scoped"</span>)
<span class="co">#&gt; [2017-06-15T15:33:25 UTC] Making 'no_scoped' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:25 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:25 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:25 UTC] * Touching 'no_scoped' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:25 UTC] DONE ('no_scoped')</span>
<span class="co">#&gt; [1] "2017-06-15 15:33:25 UTC"</span>
<span class="kw">Sys.sleep</span>(1L)
<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"no_scoped"</span>)
<span class="co">#&gt; [2017-06-15T15:33:26 UTC] Making 'no_scoped' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:26 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:26 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:26 UTC] * Touching 'no_scoped' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:26 UTC] DONE ('no_scoped')</span>
<span class="co">#&gt; [1] "2017-06-15 15:33:26 UTC"</span></code></pre></div>
<p>Notice that the expression passed to the hook is evaluated in the environment in which the module is used. Therefore, a direct call to <code>.__name__</code> would not return the name of the intuitively expected module. The following example illustrates how to circumvent this kind of difficulty.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"no_scoped"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">modulr =</span> <span class="st">"modulr"</span>
) %provides%<span class="st"> </span>{
  <span class="kw">eval</span>(<span class="kw">substitute</span>(modulr$<span class="kw"><a href="../reference/modulr-module.html">post_evaluation_hook</a></span>(<span class="kw"><a href="../reference/touch.html">touch</a></span>(me)), <span class="kw">list</span>(<span class="dt">me =</span> .__name__)))
  <span class="kw">Sys.time</span>()
}
<span class="co">#&gt; [2017-06-15T15:33:26 UTC] Re-defining 'no_scoped' ... OK</span>

<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"no_scoped"</span>)
<span class="co">#&gt; [2017-06-15T15:33:26 UTC] Making 'no_scoped' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:26 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:27 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:27 UTC] * Touching 'no_scoped' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:27 UTC] DONE ('no_scoped')</span>
<span class="co">#&gt; [1] "2017-06-15 15:33:27 UTC"</span>
<span class="kw">Sys.sleep</span>(1L)
<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"no_scoped"</span>)
<span class="co">#&gt; [2017-06-15T15:33:28 UTC] Making 'no_scoped' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:28 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:28 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:28 UTC] * Touching 'no_scoped' ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:28 UTC] DONE ('no_scoped')</span>
<span class="co">#&gt; [1] "2017-06-15 15:33:28 UTC"</span></code></pre></div>
</div>
</div>
<div id="scripting" class="section level2">
<h2 class="hasAnchor">
<a href="#scripting" class="anchor"></a>Scripting</h2>
<p>Turning a bunch of modules working perfectly well together into a script is a very common situation, that can be handled with the help of the following boilerplate code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># filepath: ./script.R</span>
<span class="st">"script"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">dep_1 =</span> <span class="st">"dependency_1"</span>,
  ...
) %provides%<span class="st"> </span>{
  function() {
    <span class="co"># body of the script here</span>
  }
}

if (.__name__ ==<span class="st"> "__main__"</span>) 
  <span class="co"># execute only if sourced/run as a script (à la Python)</span>
  <span class="kw"><a href="../reference/make.html">make</a></span>()()</code></pre></div>
</div>
<div id="experimental-features" class="section level2">
<h2 class="hasAnchor">
<a href="#experimental-features" class="anchor"></a>Experimental features</h2>
<div id="futures" class="section level3">
<h3 class="hasAnchor">
<a href="#futures" class="anchor"></a>Futures</h3>
<p>Using <a href="https://cran.r-project.org/web/packages/future">Henrik Bengtsson’s future package</a>, it is possible to evaluate modules asynchronously using various resources available to the user. For instance, evaluation of modules can be eager, lazy, and/or parallelized (on multiple cores and/or on a cluster of machines).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># How many cores are available?</span>
<span class="kw">availableCores</span>()
<span class="co">#&gt; system </span>
<span class="co">#&gt;      4</span>

<span class="st">"foo"</span> %provides%<span class="st"> </span>{
  <span class="kw">future</span>({
    <span class="kw">Sys.sleep</span>(1L)
    <span class="st">"Hello"</span>
  }) %plan%<span class="st"> </span>multicore
}
<span class="co">#&gt; [2017-06-15T15:33:28 UTC] Defining 'foo' ... OK</span>

<span class="st">"bar"</span> %provides%<span class="st"> </span>{
  <span class="kw">future</span>({
    <span class="kw">Sys.sleep</span>(1L)
    <span class="st">"World"</span>
  }) %plan%<span class="st"> </span>multicore
}
<span class="co">#&gt; [2017-06-15T15:33:28 UTC] Defining 'bar' ... OK</span>

<span class="st">"foobar"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">f =</span> <span class="st">"foo"</span>,
  <span class="dt">b =</span> <span class="st">"bar"</span>
) %provides%<span class="st"> </span>{
  <span class="kw">paste0</span>(<span class="kw">value</span>(f), <span class="st">" "</span>, <span class="kw">value</span>(b), <span class="st">"!"</span>)
}
<span class="co">#&gt; [2017-06-15T15:33:28 UTC] Defining 'foobar' ... OK</span>

<span class="kw">system.time</span>(<span class="kw">print</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foobar"</span>)))
<span class="co">#&gt; [2017-06-15T15:33:28 UTC] Making 'foobar' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:28 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:28 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:28 UTC] * Sorting 2 dependencies with 2 relations ... on 1 layer, OK</span>
<span class="co">#&gt; [2017-06-15T15:33:28 UTC] * Evaluating new and outdated dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:28 UTC] ** Evaluating #1/2 (layer #1/1): 'bar' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:28 UTC] ** Evaluating #2/2 (layer #1/1): 'foo' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:29 UTC] DONE ('foobar')</span>
<span class="co">#&gt; [1] "Hello World!"</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.046   0.008   1.053</span></code></pre></div>
<p>It is often interesting to parallelize an already existing module. <code>modulr</code> comes with the handy <code>futurize</code> function for this purpose. The following two examples illustrate the difference between eager and lazy orchestrations of parallelized modules.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"foo"</span> %provides%<span class="st"> </span>{ <span class="kw">Sys.sleep</span>(1L); <span class="st">"Hello"</span> }
<span class="co">#&gt; [2017-06-15T15:33:29 UTC] Defining 'foo' ... OK</span>
<span class="st">"bar"</span> %provides%<span class="st"> </span>{ <span class="kw">Sys.sleep</span>(1L); <span class="st">"World"</span> }
<span class="co">#&gt; [2017-06-15T15:33:29 UTC] Defining 'bar' ... OK</span>
<span class="st">"foobar"</span> %requires%<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">f =</span> <span class="st">"foo"</span>, 
  <span class="dt">b =</span> <span class="st">"bar"</span>
) %provides%<span class="st"> </span>{
  <span class="kw">paste0</span>(f, <span class="st">" "</span>, b, <span class="st">"!"</span>)
}
<span class="co">#&gt; [2017-06-15T15:33:29 UTC] Defining 'foobar' ... OK</span>

<span class="kw"><a href="../reference/futurize.html">futurize</a></span>(<span class="st">"foo"</span>, <span class="dt">strategy =</span> multicore)
<span class="co">#&gt; [2017-06-15T15:33:29 UTC] Defining 'foo/future' ... OK</span>
<span class="kw"><a href="../reference/futurize.html">futurize</a></span>(<span class="st">"bar"</span>, <span class="dt">strategy =</span> multicore)
<span class="co">#&gt; [2017-06-15T15:33:29 UTC] Defining 'bar/future' ... OK</span>

<span class="kw"><a href="../reference/futurize.html">futurize</a></span>(
  <span class="st">"foobar"</span>, 
  <span class="dt">name =</span> <span class="st">"foobar/eager"</span>, 
  <span class="dt">dependencies =</span> <span class="kw">list</span>(<span class="dt">f =</span> <span class="st">"foo/future"</span>, <span class="dt">b =</span> <span class="st">"bar/future"</span>),
  <span class="dt">strategy =</span> eager
)
<span class="co">#&gt; [2017-06-15T15:33:29 UTC] Defining 'foobar/eager' ... OK</span>

<span class="kw">system.time</span>(fb_eager &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foobar/eager"</span>))
<span class="co">#&gt; [2017-06-15T15:33:29 UTC] Making 'foobar/eager' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:29 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:29 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:29 UTC] * Sorting 2 dependencies with 2 relations ... on 1 layer, OK</span>
<span class="co">#&gt; [2017-06-15T15:33:29 UTC] * Evaluating new and outdated dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:29 UTC] ** Evaluating #1/2 (layer #1/1): 'bar/future' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:29 UTC] ** Evaluating #2/2 (layer #1/1): 'foo/future' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:30 UTC] DONE ('foobar/eager')</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.112   0.014   1.110</span>
<span class="kw">system.time</span>(<span class="kw">print</span>(<span class="kw">value</span>(fb_eager)))
<span class="co">#&gt; [1] "Hello World!"</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;       0       0       0</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/touch.html">touch</a></span>(<span class="st">"foo/future"</span>)
<span class="co">#&gt; [2017-06-15T15:33:30 UTC] Touching 'foo/future' ... OK</span>
<span class="kw"><a href="../reference/touch.html">touch</a></span>(<span class="st">"bar/future"</span>)
<span class="co">#&gt; [2017-06-15T15:33:30 UTC] Touching 'bar/future' ... OK</span>
<span class="kw"><a href="../reference/futurize.html">futurize</a></span>(
  <span class="st">"foobar"</span>, 
  <span class="dt">name =</span> <span class="st">"foobar/lazy"</span>, 
  <span class="dt">dependencies =</span> <span class="kw">list</span>(<span class="dt">f =</span> <span class="st">"foo/future"</span>, <span class="dt">b =</span> <span class="st">"bar/future"</span>),
  <span class="dt">strategy =</span> lazy
)
<span class="co">#&gt; [2017-06-15T15:33:30 UTC] Defining 'foobar/lazy' ... OK</span>

<span class="kw">system.time</span>(fb_lazy &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foobar/lazy"</span>))
<span class="co">#&gt; [2017-06-15T15:33:30 UTC] Making 'foobar/lazy' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:30 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:30 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2017-06-15T15:33:30 UTC] * Sorting 2 dependencies with 2 relations ... on 1 layer, OK</span>
<span class="co">#&gt; [2017-06-15T15:33:30 UTC] * Evaluating new and outdated dependencies ...</span>
<span class="co">#&gt; [2017-06-15T15:33:30 UTC] ** Evaluating #1/2 (layer #1/1): 'bar/future' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:30 UTC] ** Evaluating #2/2 (layer #1/1): 'foo/future' ...</span>
<span class="co">#&gt; [2017-06-15T15:33:31 UTC] DONE ('foobar/lazy')</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.047   0.015   0.062</span>
<span class="kw">Sys.sleep</span>(<span class="fl">0.5</span>)
<span class="kw">system.time</span>(<span class="kw">print</span>(<span class="kw">value</span>(fb_lazy)))
<span class="co">#&gt; [1] "Hello World!"</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.005   0.008   0.401</span></code></pre></div>
</div>
<div id="package-isolation" class="section level3">
<h3 class="hasAnchor">
<a href="#package-isolation" class="anchor"></a>Package isolation</h3>
</div>
</div>
<div id="coding-style" class="section level2">
<h2 class="hasAnchor">
<a href="#coding-style" class="anchor"></a>Coding style</h2>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#anatomy-of-a-module">Anatomy of a module</a></li>
      <li><a href="#a-first-example">A first example</a></li>
      <li><a href="#types-of-modules">Types of modules</a></li>
      <li><a href="#semantic-versioning-semver">Semantic Versioning (SemVer)</a></li>
      <li><a href="#location-of-modules">Location of modules</a></li>
      <li><a href="#testing">Testing</a></li>
      <li><a href="#special-variables">Special variables</a></li>
      <li><a href="#the-special-module-modulr">The special module <code>modulr</code></a></li>
      <li><a href="#scripting">Scripting</a></li>
      <li><a href="#experimental-features">Experimental features</a></li>
      <li><a href="#coding-style">Coding style</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Alain Clément-Pavon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
