<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to modulr • modulr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google analytics --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36176577-2', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">modulr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/motivation.html">Why DI for R?</a>
</li>
<li>
  <a href="../articles/modulr.html">Introduction</a>
</li>
<li>
  <a href="../articles/testing.html">Unit Testing</a>
</li>
<li>
  <a href="../articles/packages.html">Using modulr in packages</a>
</li>
<li>
  <a href="../articles/experimental.html">Experimental</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/aclemen1/modulr">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="modulr_files/htmlwidgets-0.8/htmlwidgets.js"></script><script src="modulr_files/d3-3.5.15/d3.min.js"></script><script src="modulr_files/sankey-1/sankey.js"></script><script src="modulr_files/sankeyNetwork-binding-0.2.13/sankeyNetwork.js"></script><script src="modulr_files/d3-tip-0.6.7/index.js"></script><link href="modulr_files/chorddiag-0.0.0.9000/chorddiag.css" rel="stylesheet">
<script src="modulr_files/chorddiag-0.0.0.9000/chorddiag.js"></script><script src="modulr_files/chorddiag-binding-0.1.1/chorddiag.js"></script><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Introduction to modulr</h1>
            
          </div>

    
    
<div class="contents">
<div id="anatomy-of-a-module" class="section level1">
<h1 class="hasAnchor">
<a href="#anatomy-of-a-module" class="anchor"></a>Anatomy of a module</h1>
<p>Modules are defined in a declarative way, using the keywords <code>%requires%</code> and <code>%provides%</code>, and have four main components:</p>
<ul>
<li>A <strong>name</strong>, which identifies the module.</li>
<li>A list of required <strong>dependencies</strong>, if any.</li>
<li>A <strong>provider</strong>, which expresses the module’s feature(s).</li>
<li>Optional <strong>docstrings</strong>, intended to document the internals of a module.</li>
</ul>
<p>A typical module looks like the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"name_of_module"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(

  <span class="co"># A list of dependencies.</span>
  <span class="dt">dependency_1 =</span> <span class="st">"name_of_dependency_1"</span>, 
  <span class="dt">dependency_2 =</span> <span class="st">"name_of_dependency_1"</span>,
  <span class="dt">... =</span> <span class="st">"..."</span>

) <span class="op">%provides%</span><span class="st"> </span>{

  <span class="co">#' A recommended docstring intended to document the internals of the module.</span>

  <span class="co"># A section where add-on packages are loaded and attached.</span>
  <span class="kw">library</span>(package_<span class="dv">1</span>)
  <span class="kw">library</span>(package_<span class="dv">2</span>)
  <span class="kw">library</span>(...)

  <span class="co"># Some code that uses the objects `dependency_1` and `dependency_2" </span>
  <span class="co"># returned by the modules "name_of_dependency_1" and "name_of_dependency_2".</span>
  object &lt;-<span class="st"> </span>{ ... }

  <span class="co"># A resulting object, which can be directly consumed or in turn injected as a </span>
  <span class="co"># dependency.</span>
  <span class="kw">return</span>(object)

} </code></pre></div>
<p>When a module is defined, modulr has to <em>make</em> it in order to evaluate the code it provides:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"name_of_module"</span>) </code></pre></div>
<p>or with a handy <em>syntactic sugar</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result <span class="op">%&lt;=%</span><span class="st"> "name_of_module"</span> </code></pre></div>
<p>or interactively with the <code>hit</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/hit.html">hit</a></span>(name_of_module) <span class="co"># or</span>
<span class="kw"><a href="../reference/hit.html">hit</a></span>(name_of) <span class="co"># which will prompt the user to choose among all possible match</span></code></pre></div>
<p>The result contains the computed object exposed by the module. Under the hood, the dependencies have been sorted and appropriately made, and their resulting objects injected where required.</p>
</div>
<div id="a-first-working-example" class="section level1">
<h1 class="hasAnchor">
<a href="#a-first-working-example" class="anchor"></a>A first working example</h1>
<p>Let us start by defining some modules and dependencies:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"foo"</span> <span class="op">%provides%</span><span class="st"> "Hello"</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] Defining 'foo' ... OK</span>

<span class="st">"bar"</span> <span class="op">%provides%</span><span class="st"> "World"</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] Defining 'bar' ... OK</span>

<span class="st">"baz"</span> <span class="op">%provides%</span><span class="st"> "!"</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] Defining 'baz' ... OK</span>

<span class="st">"foobar"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">f =</span> <span class="st">"foo"</span>, 
  <span class="dt">b =</span> <span class="st">"bar"</span>,
  <span class="dt">z =</span> <span class="st">"baz"</span>
) <span class="op">%provides%</span><span class="st"> </span>{ 
  <span class="co">#' Return a concatenated string. </span>
  <span class="kw">paste0</span>(f, <span class="st">", "</span>, <span class="kw">tolower</span>(b), z) 
} 
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] Defining 'foobar' ... OK</span></code></pre></div>
<p>Use <code>info</code> to output the docstrings:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/print_info.html">info</a></span>(<span class="st">"foobar"</span>) 
<span class="co">#&gt; Return a concatenated string.</span></code></pre></div>
<p>Use <code>lsmod</code> to list all defined modules and their properties in a data frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/list_modules.html">lsmod</a></span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">"name"</span>, <span class="st">"type"</span>, <span class="st">"dependencies"</span>, <span class="st">"uses"</span>, <span class="st">"size"</span>, <span class="st">"modified"</span>)) 
<span class="co">#&gt;     name type dependencies uses      size                modified</span>
<span class="co">#&gt; 1    bar &lt;NA&gt;            0    1 152 bytes 2018-10-25T19:37:18 UTC</span>
<span class="co">#&gt; 2    baz &lt;NA&gt;            0    1 152 bytes 2018-10-25T19:37:18 UTC</span>
<span class="co">#&gt; 3    foo &lt;NA&gt;            0    1 152 bytes 2018-10-25T19:37:18 UTC</span>
<span class="co">#&gt; 4 foobar &lt;NA&gt;            3    0    5.2 Kb 2018-10-25T19:37:18 UTC</span></code></pre></div>
<p>In this example, <code>foobar</code> relies on three dependencies, and <code>foo</code>, <code>bar</code> and <code>baz</code> are both injected once. Use <code>plot_dependencies</code> to see these relations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_dependencies.html">plot_dependencies</a></span>() </code></pre></div>
<div id="htmlwidget-1d9f9b9fdca3023baa83" style="width:90%;height:384px;" class="sankeyNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-1d9f9b9fdca3023baa83">{"x":{"links":{"source":[0,1,2],"target":[3,3,3],"value":[1,1,1]},"nodes":{"name":["foo","bar","baz","foobar"],"group":["foo","bar","baz","foobar"]},"options":{"NodeID":"node","NodeGroup":"node","LinkGroup":null,"colourScale":"d3.scale.category20()","fontSize":13,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":32}},"evals":[],"jsHooks":[]}</script><div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_dependencies.html">plot_dependencies</a></span>(<span class="dt">render_engine =</span> chord_engine) </code></pre></div>
<div id="htmlwidget-b18b48ec4ad649442f3b" style="width:90%;height:384px;" class="chorddiag html-widget"></div>
<script type="application/json" data-for="htmlwidget-b18b48ec4ad649442f3b">{"x":{"matrix":[[0,1,1,1],[1,0,0,0],[1,0,0,0],[1,0,0,0]],"options":{"type":"bipartite","width":null,"height":null,"margin":100,"showGroupnames":true,"groupNames":["foobar","foo","baz","bar"],"groupColors":["#E41A1C","#7E6E85","#E1C62F","#999999"],"groupThickness":0.1,"groupPadding":0.0349065850398866,"groupnamePadding":[10,10,10,10],"groupnameFontsize":11,"groupedgeColor":null,"chordedgeColor":"#808080","categoryNames":["module","dependency"],"categorynamePadding":100,"categorynameFontsize":28,"showTicks":false,"tickInterval":0.1,"ticklabelFontsize":10,"fadeLevel":0.1,"showTooltips":true,"showZeroTooltips":true,"tooltipNames":["foobar","foo","baz","bar"],"tooltipFontsize":12,"tooltipUnit":"","tooltipGroupConnector":" &#x25B6; ","precision":"null","clickAction":null}},"evals":[],"jsHooks":[]}</script><p>Use <code>make</code> to get the resulting object provided by the module:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foobar"</span>)
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] Making 'foobar' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] * Sorting 3 dependencies with 3 relations ... on 1 layer, OK</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] * Evaluating new and outdated dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] ** Evaluating #1/3 (layer #1/1): 'baz' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] ** Evaluating #2/3 (layer #1/1): 'bar' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] ** Evaluating #3/3 (layer #1/1): 'foo' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] DONE ('foobar' in 0.069 secs)</span>
<span class="co">#&gt; [1] "Hello, world!"</span></code></pre></div>
<p>Voilà! All the depencencies have been evaluated, injected and processed to return the expected <code>"Hello, world!"</code>. As a matter of fact, the dependencies form a <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph">directed acyclic graph</a> which is topologically sorted, just in time to determine a well ordering for their evaluation before injection.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/list_modules.html">lsmod</a></span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">"name"</span>, <span class="st">"type"</span>, <span class="st">"dependencies"</span>, <span class="st">"uses"</span>, <span class="st">"size"</span>, <span class="st">"modified"</span>)) 
<span class="co">#&gt;     name      type dependencies uses      size                modified</span>
<span class="co">#&gt; 1    bar character            0    1 152 bytes 2018-10-25T19:37:18 UTC</span>
<span class="co">#&gt; 2    baz character            0    1 152 bytes 2018-10-25T19:37:18 UTC</span>
<span class="co">#&gt; 3    foo character            0    1 152 bytes 2018-10-25T19:37:18 UTC</span>
<span class="co">#&gt; 4 foobar character            3    0    5.2 Kb 2018-10-25T19:37:18 UTC</span></code></pre></div>
</div>
<div id="types-of-modules" class="section level1">
<h1 class="hasAnchor">
<a href="#types-of-modules" class="anchor"></a>Types of modules</h1>
<div id="singletons" class="section level2">
<h2 class="hasAnchor">
<a href="#singletons" class="anchor"></a>Singletons</h2>
<p>All modules are singletons: once evaluated, they always return the same resulting object. This is one of the great advantages of modulr: module evaluation takes place parsimoniously, when changes are detected or explicitely required, à la <a href="https://www.gnu.org/software/make">GNU Make</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"timestamp"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="co">#' Return a string containing a timestamp.</span>
  <span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">"%H:%M:%OS6"</span>)
}
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] Defining 'timestamp' ... OK</span></code></pre></div>
<p>Successive <code>make</code> calls on the module will not imply its re-evaluation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"timestamp"</span>)
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] Making 'timestamp' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] DONE ('timestamp' in 0.02 secs)</span>
<span class="co">#&gt; [1] "19:37:18.841889"</span>
<span class="kw"><a href="../reference/with_verbosity.html">with_verbosity</a></span>(<span class="dv">0</span>, <span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"timestamp"</span>)) <span class="co"># temporarily change the verbosity of make</span>
<span class="co">#&gt; [1] "19:37:18.841889"</span></code></pre></div>
<p>Notice the <code>with_verbosity</code> wrapper around the call. To force re-evaluation, just <code>touch</code> the module:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/touch.html">touch</a></span>(<span class="st">"timestamp"</span>)
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] Touching 'timestamp' ... OK</span>
<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"timestamp"</span>)
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] Making 'timestamp' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] DONE ('timestamp' in 0.018 secs)</span>
<span class="co">#&gt; [1] "19:37:18.897315"</span></code></pre></div>
<p>Any change of the module’s definition (even its docstrings) will be detected:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"timestamp"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="co">#' Return a string containing a timestamp with more information.</span>
  <span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">"%Y-%m-%d %H:%M:%OS6"</span>)
}
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] Re-defining 'timestamp' ... OK</span>

<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"timestamp"</span>)
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] Making 'timestamp' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] DONE ('timestamp' in 0.018 secs)</span>
<span class="co">#&gt; [1] "2018-10-25 19:37:18.934011"</span></code></pre></div>
</div>
<div id="prototypes" class="section level2">
<h2 class="hasAnchor">
<a href="#prototypes" class="anchor"></a>Prototypes</h2>
<p>It is granted that all modules are singletons. Nonetheless, a module is allowed to return any object, in particular it can return a function (closure) that itself returns a desired object or produces some side effect. In this case, such a module behaves like a so-called <em>prototype</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"timestamp"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="cf">function</span>() <span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">"%H:%M:%OS6"</span>)
}
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] Defining 'timestamp' ... OK</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"timestamp"</span>)()
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] Making 'timestamp' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:18 UTC] DONE ('timestamp' in 0.018 secs)</span>
<span class="co">#&gt; [1] "19:37:18.989753"</span>

<span class="kw"><a href="../reference/with_verbosity.html">with_verbosity</a></span>(0L, <span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"timestamp"</span>)())
<span class="co">#&gt; [1] "19:37:19.011173"</span></code></pre></div>
<p>It is important to emphasize that the module is still a singleton: the second <code>make</code> call doesn’t re-evaluate. But the function that is returned by the module is itself re-evaluated each time it is called.</p>
</div>
<div id="memoised-prototypes" class="section level2">
<h2 class="hasAnchor">
<a href="#memoised-prototypes" class="anchor"></a>Memoised prototypes</h2>
<p>Singletons produce cached objects at make-time and prototypes produce computed objects at run-time. In a complementary manner, memoised modules produce cached objects at run-time. <a href="https://en.wikipedia.org/wiki/Memoization">Memoisation</a> and <a href="https://github.com/hadley/memoise">Hadley Wickam’s memoise package</a> give an elegant solution to this requirement.</p>
<p>To see the essence of what is happening, we decrease the verbosity of modulr and set up a simple starting scenario: <code>foo</code> requires the somewhat resource-consuming <code>timestamp</code> module, defined as a singleton:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/set_verbosity.html">set_verbosity</a></span>(1L) <span class="co"># messages are shown only when changes occur</span>

<span class="st">"timestamp"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="co"># This is a singleton.</span>
  <span class="kw">message</span>(<span class="st">"'timestamp' is evaluated after a (short) pause..."</span>)
  <span class="kw">Sys.sleep</span>(1L)
  <span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">"%H:%M:%OS6"</span>)
}

<span class="st">"foo"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">timestamp =</span> <span class="st">"timestamp"</span>
) <span class="op">%provides%</span><span class="st"> </span>{
  <span class="st">"foo"</span>
}
<span class="co">#&gt; Warning: [2018-10-25T19:37:19 UTC] Possibly unused dependency: 'timestamp'.</span>

<span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foo"</span>))
<span class="co">#&gt; [2018-10-25T19:37:19 UTC] Evaluating #1/1 (layer #1/1): 'timestamp' ...</span>
<span class="co">#&gt; 'timestamp' is evaluated after a (short) pause...</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.036   0.000   1.037</span></code></pre></div>
<p>In this example, <code>timestamp</code> is evaluated even though it is not explicitely used by <code>foo</code>. It just computes a timestamp after a short pause, but it could be virtually very resource-consuming at make-time.</p>
<p>Let us re-define <code>timestamp</code> as a prototype:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"timestamp"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="co"># This is a prototype.</span>
  <span class="cf">function</span>() {
    <span class="kw">message</span>(<span class="st">"'timestamp' is evaluated after a (short) pause..."</span>)
    <span class="kw">Sys.sleep</span>(1L)
    <span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">"%H:%M:%OS6"</span>)
  }
}
<span class="co">#&gt; [2018-10-25T19:37:20 UTC] Re-defining 'timestamp' ... OK</span>

<span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foo"</span>))
<span class="co">#&gt; [2018-10-25T19:37:20 UTC] Evaluating #1/1 (layer #1/1): 'timestamp' ...</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.053   0.001   0.053</span></code></pre></div>
<p>Here, the evaluation consists of defining a function that pauses for a while and returns a timestamp, only when the function is explicitely called. Even if the computation encapsulated by the function is very resource-consuming, no evaluation of the returned function takes place at make-time.</p>
<p>Finally, let us re-define <code>timestamp</code> as a memoised module:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"timestamp"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="co"># This is a memoised module.</span>
  memoise<span class="op">::</span><span class="kw">memoise</span>(
    <span class="cf">function</span>() {
      <span class="kw">message</span>(<span class="st">"'timestamp' is evaluated after a (short) pause..."</span>)
      <span class="kw">Sys.sleep</span>(1L)
      <span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">"%H:%M:%OS6"</span>)
    }
  )
}
<span class="co">#&gt; [2018-10-25T19:37:20 UTC] Re-defining 'timestamp' ... OK</span>

<span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foo"</span>))
<span class="co">#&gt; [2018-10-25T19:37:20 UTC] Evaluating #1/1 (layer #1/1): 'timestamp' ...</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.053   0.001   0.055</span></code></pre></div>
<p>The <code>timestamp</code> module returns a function which will be evaluated only when explicitely called at run-time. Let us re-define <code>foo</code> in order that it effectively uses <code>timestamp</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"foo"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">timestamp =</span> <span class="st">"timestamp"</span>
) <span class="op">%provides%</span><span class="st"> </span>{
  <span class="kw">message</span>(<span class="st">"It is "</span>, <span class="kw">timestamp</span>())
  <span class="st">"foo"</span>
}
<span class="co">#&gt; [2018-10-25T19:37:20 UTC] Re-defining 'foo' ... OK</span>

<span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foo"</span>))
<span class="co">#&gt; 'timestamp' is evaluated after a (short) pause...</span>
<span class="co">#&gt; It is 19:37:21.613370</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.052   0.000   1.053</span></code></pre></div>
<p>Here, a timestamped message is outputed. Let us force the re-evaluation of <code>foo</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/touch.html">touch</a></span>(<span class="st">"foo"</span>)
<span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foo"</span>))
<span class="co">#&gt; It is 19:37:21.613370</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.035   0.000   0.035</span></code></pre></div>
<p>The memoised version of <code>timestamp</code> is evaluated only at run-time, not at make-time; moreover, the string containing the actual timestamp is computed only once and then cached for future calls, avoiding re-evaluation.</p>
<p>To force re-evaluation of the memoised function exposed by <code>timestamp</code>, use <code>memoise::forget</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">memoise<span class="op">::</span><span class="kw">forget</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"timestamp"</span>))
<span class="co">#&gt; [1] TRUE</span>
<span class="kw"><a href="../reference/touch.html">touch</a></span>(<span class="st">"foo"</span>)
<span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"foo"</span>))
<span class="co">#&gt; 'timestamp' is evaluated after a (short) pause...</span>
<span class="co">#&gt; It is 19:37:22.846025</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.034   0.000   1.036</span></code></pre></div>
</div>
<div id="lists" class="section level2">
<h2 class="hasAnchor">
<a href="#lists" class="anchor"></a>Lists</h2>
<p>It is often useful for a module to expose several (immutable, cf. infra) objects at once by returning a list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"timestamps"</span> <span class="op">%provides%</span><span class="st"> </span>{
  now &lt;-<span class="st"> </span><span class="cf">function</span>() <span class="kw">Sys.time</span>()
  <span class="kw">list</span>(
    <span class="dt">origin =</span> <span class="kw">structure</span>(0L, <span class="dt">class =</span> <span class="st">"Date"</span>),
    <span class="dt">yesterday =</span> <span class="cf">function</span>() <span class="kw">now</span>() <span class="op">-</span><span class="st"> </span>86400L,
    <span class="dt">now =</span> now,
    <span class="dt">tomorrow =</span> <span class="cf">function</span>() <span class="kw">now</span>() <span class="op">+</span><span class="st"> </span>86400L
  )
}
<span class="co">#&gt; [2018-10-25T19:37:22 UTC] Defining 'timestamps' ... OK</span>

ts <span class="op">%&lt;=%</span><span class="st"> "timestamps"</span>
<span class="co">#&gt; [2018-10-25T19:37:22 UTC] Making 'timestamps' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:22 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:22 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:22 UTC] DONE ('timestamps' in 0.02 secs)</span>

ts<span class="op">$</span>origin
<span class="co">#&gt; [1] "1970-01-01"</span>
ts<span class="op">$</span><span class="kw">yesterday</span>()
<span class="co">#&gt; [1] "2018-10-24 19:37:22 UTC"</span>
ts<span class="op">$</span><span class="kw">now</span>()
<span class="co">#&gt; [1] "2018-10-25 19:37:22 UTC"</span>
ts<span class="op">$</span><span class="kw">tomorrow</span>()
<span class="co">#&gt; [1] "2018-10-26 19:37:22 UTC"</span></code></pre></div>
</div>
<div id="environments" class="section level2">
<h2 class="hasAnchor">
<a href="#environments" class="anchor"></a>Environments</h2>
<p>It is often useful for a module to expose several mutable objects at once by returning an environment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"configuration"</span> <span class="op">%provides%</span><span class="st"> </span>{
  env &lt;-<span class="st"> </span><span class="kw">new.env</span>(<span class="dt">parent =</span> <span class="kw">emptyenv</span>())
  env<span class="op">$</span>shape &lt;-<span class="st"> "circle"</span>
  env<span class="op">$</span>color &lt;-<span class="st"> "blue"</span>
  env<span class="op">$</span>size &lt;-<span class="st"> </span>13L
  env
}
<span class="co">#&gt; [2018-10-25T19:37:22 UTC] Defining 'configuration' ... OK</span>

config <span class="op">%&lt;=%</span><span class="st"> "configuration"</span>
<span class="co">#&gt; [2018-10-25T19:37:22 UTC] Making 'configuration' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:22 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:22 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:22 UTC] DONE ('configuration' in 0.017 secs)</span>

config<span class="op">$</span>color
<span class="co">#&gt; [1] "blue"</span>
config<span class="op">$</span>color &lt;-<span class="st"> "red"</span>
config<span class="op">$</span>color
<span class="co">#&gt; [1] "red"</span></code></pre></div>
<p>This kind of module can be used to share mutable data between modules, without polluting the Global Environment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"widget_A"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">config =</span> <span class="st">"configuration"</span>
) <span class="op">%provides%</span><span class="st"> </span>{
  <span class="kw">list</span>(
    <span class="dt">switch_color =</span> <span class="cf">function</span>()
      config<span class="op">$</span>color &lt;-<span class="st"> </span><span class="cf">if</span> (config<span class="op">$</span>color <span class="op">==</span><span class="st"> "blue"</span>) <span class="st">"red"</span> <span class="cf">else</span> <span class="st">"blue"</span>
  )
}
<span class="co">#&gt; [2018-10-25T19:37:22 UTC] Defining 'widget_A' ... OK</span>

<span class="st">"widget_B"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">config =</span> <span class="st">"configuration"</span>
) <span class="op">%provides%</span><span class="st"> </span>{
  <span class="kw">list</span>(
    <span class="dt">switch_shape =</span> <span class="cf">function</span>()
      config<span class="op">$</span>shape &lt;-<span class="st"> </span><span class="cf">if</span> (config<span class="op">$</span>shape <span class="op">==</span><span class="st"> "circle"</span>) <span class="st">"square"</span> <span class="cf">else</span> <span class="st">"circle"</span>
  )
}
<span class="co">#&gt; [2018-10-25T19:37:22 UTC] Defining 'widget_B' ... OK</span>

widget_A <span class="op">%&lt;=%</span><span class="st"> "widget_A"</span>
<span class="co">#&gt; [2018-10-25T19:37:22 UTC] Making 'widget_A' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:22 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] DONE ('widget_A' in 0.032 secs)</span>
widget_B <span class="op">%&lt;=%</span><span class="st"> "widget_B"</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] Making 'widget_B' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] DONE ('widget_B' in 0.035 secs)</span>

widget_A<span class="op">$</span><span class="kw">switch_color</span>()
config<span class="op">$</span>color
<span class="co">#&gt; [1] "blue"</span>

widget_B<span class="op">$</span><span class="kw">switch_shape</span>()
config<span class="op">$</span>shape
<span class="co">#&gt; [1] "square"</span></code></pre></div>
<p>The modulr package implements the dedicated syntactic sugar <code>%provides_options%</code> for this frequent purpose.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/undefine.html">undefine</a></span>(<span class="st">"configuration"</span>)
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] Undefining 'configuration' ... OK</span>

<span class="st">"configuration"</span> <span class="op">%provides_options%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">shape =</span> <span class="st">"circle"</span>,
  <span class="dt">color =</span> <span class="st">"blue"</span>,
  <span class="dt">size =</span> 13L
)
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] Defining 'configuration' ... OK</span>

config <span class="op">%&lt;=%</span><span class="st"> "configuration"</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] Making 'configuration' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] DONE ('configuration' in 0.017 secs)</span>
widget_A <span class="op">%&lt;=%</span><span class="st"> "widget_A"</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] Making 'widget_A' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] DONE ('widget_A' in 0.035 secs)</span>

config<span class="op">$</span>color
<span class="co">#&gt; [1] "blue"</span>
widget_A<span class="op">$</span><span class="kw">switch_color</span>()
config<span class="op">$</span>color
<span class="co">#&gt; [1] "red"</span></code></pre></div>
<p>It is also possible to use the <strong>shared environment</strong> associated to every injector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"widget_B_prime"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="kw">list</span>(
    <span class="dt">switch_shape =</span> <span class="cf">function</span>()
      .SharedEnv<span class="op">$</span>shape &lt;-<span class="st"> </span>
<span class="st">        </span><span class="cf">if</span> (.SharedEnv<span class="op">$</span>shape <span class="op">==</span><span class="st"> "circle"</span>) <span class="st">"square"</span> <span class="cf">else</span> <span class="st">"circle"</span>
  )
}
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] Defining 'widget_B_prime' ... OK</span>

widget_B_prime &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make.html">make</a></span>()
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] Making 'widget_B_prime' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] DONE ('widget_B_prime' in 0.018 secs)</span>

.SharedEnv<span class="op">$</span>shape &lt;-<span class="st"> "circle"</span>
widget_B_prime<span class="op">$</span><span class="kw">switch_shape</span>()
.SharedEnv<span class="op">$</span>shape
<span class="co">#&gt; [1] "square"</span></code></pre></div>
</div>
<div id="byte-compiled-modules" class="section level2">
<h2 class="hasAnchor">
<a href="#byte-compiled-modules" class="anchor"></a>Byte-compiled modules</h2>
<p>Since a module is allowed to expose any R object, there is no restriction on byte-compiled code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"hello"</span> <span class="op">%provides%</span><span class="st"> </span>{
  compiler<span class="op">::</span><span class="kw">compile</span>(<span class="st">"Hello, world!"</span>)
}
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] Defining 'hello' ... OK</span>

<span class="kw">eval</span>(<span class="kw"><a href="../reference/make.html">make</a></span>())
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] Making 'hello' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] DONE ('hello' in 0.025 secs)</span>
<span class="co">#&gt; [1] "Hello, world!"</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"lapply_old"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="co"># Old R version of lapply.</span>
  <span class="cf">function</span>(X, FUN, ...) {
    FUN &lt;-<span class="st"> </span><span class="kw">match.fun</span>(FUN)
    <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.list</span>(X))
      X &lt;-<span class="st"> </span><span class="kw">as.list</span>(X)
    rval &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">"list"</span>, <span class="kw">length</span>(X))
    <span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dt">along =</span> X))
      rval[i] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">FUN</span>(X[[i]], ...))
    <span class="kw">names</span>(rval) &lt;-<span class="st"> </span><span class="kw">names</span>(X) <span class="co"># keep `names' !</span>
    <span class="kw">return</span>(rval)
  }
}
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] Defining 'lapply_old' ... OK</span>

<span class="st">"lapply_old/compiled"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">lapply_old =</span> <span class="st">"lapply_old"</span>
) <span class="op">%provides%</span><span class="st"> </span>{
  compiler<span class="op">::</span><span class="kw">cmpfun</span>(lapply_old)
}
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] Defining 'lapply_old/compiled' ... OK</span>

lapply_old <span class="op">%&lt;=%</span><span class="st"> "lapply_old"</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] Making 'lapply_old' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] DONE ('lapply_old' in 0.017 secs)</span>
lapply_old_compiled <span class="op">%&lt;=%</span><span class="st"> "lapply_old/compiled"</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] Making 'lapply_old/compiled' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] DONE ('lapply_old/compiled' in 0.053 secs)</span>

<span class="kw">system.time</span>(<span class="cf">for</span> (i <span class="cf">in</span> 1L<span class="op">:</span>10000L) <span class="kw">lapply_old</span>(1L<span class="op">:</span>10L, is.null))
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.289   0.006   0.295</span>
<span class="kw">system.time</span>(<span class="cf">for</span> (i <span class="cf">in</span> 1L<span class="op">:</span>10000L) <span class="kw">lapply_old_compiled</span>(1L<span class="op">:</span>10L, is.null))
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.182   0.000   0.182</span></code></pre></div>
</div>
</div>
<div id="semantic-versioning-semver" class="section level1">
<h1 class="hasAnchor">
<a href="#semantic-versioning-semver" class="anchor"></a>Semantic Versioning (SemVer)</h1>
<p>The modulr package offers <a href="http://semver.org">Semantic Versioning</a> capabilities: every module can live in several versions numbers of the form <code>x.y.z</code>, where <em>x</em>, <em>y</em>, and <em>z</em> are the <strong>major</strong>, <strong>minor</strong>, and <strong>patch</strong> versions, respectively. For instance, <code>foo#1.2.3</code> designates module <em>foo</em> in version <em>1.2.3</em>.</p>
<p>Given a version number, increment the:</p>
<ul>
<li>
<strong>major</strong> version when you make incompatible changes,</li>
<li>
<strong>minor</strong> version when you refactor and/or add functionality in a backwards-compatible manner, and</li>
<li>
<strong>patch</strong> version when you make backwards-compatible bug fixes.</li>
</ul>
<p>For instance, <code>foo#1.2.3</code> becomes <code>foo#1.2.4</code> after a bug fix and <code>foo#1.3.0</code> after a functionality bump.</p>
<p>Use:</p>
<ul>
<li>
<code>~x.y.z</code> to refer to the most up-to-date available patch version above <em>x.y.z</em> and <strong>allow bug fixes, but nothing else</strong>,</li>
<li>
<code>^x.y.z</code> or <code>^x.y</code> to refer to the most up-to-date available minor version above <em>x.y</em> and <strong>allow bug fixes and new functionalites, but nothing else</strong>, and</li>
<li>
<code>&gt;=x.y.z</code>, <code>&gt;=x.y</code>, or <code>&gt;=x</code> to refer to the most up-to-date version above <em>x.y.z</em>, <em>x.y</em>, or <em>x</em>, and <strong>live on the edge of developpments</strong>.</li>
</ul>
<p>Here are some examples among <code>foo#1.2.3</code>, <code>foo#1.2.4</code>, <code>foo#1.3.0</code>:</p>
<ul>
<li>
<code>foo#~1.2.0</code> refers to <code>foo#1.2.4</code>,</li>
<li>
<code>foo#~1.2.5</code> refers to nothing,</li>
<li>
<code>foo#^1.2.5</code> and <code>foo#^1.1</code> refer to <code>foo#1.3.0</code>,</li>
<li>
<code>foo#^1.3.1</code> and <code>foo#^1.4</code> refer to nothing, and</li>
<li>
<code>foo#&gt;=1.1.0</code>, <code>foo#&gt;=1.5</code>, and <code>foo#&gt;=0</code> (aka <em>latest</em>) refer to <code>foo#1.3.0</code>.</li>
</ul>
<div id="initial-scenario-no-versioning" class="section level2">
<h2 class="hasAnchor">
<a href="#initial-scenario-no-versioning" class="anchor"></a>Initial scenario: no versioning</h2>
<p>There is a good chance that your initial scenario contains no versioned module.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"great_module"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="cf">function</span>() {
    <span class="kw">Sys.sleep</span>(1L)
    <span class="st">"great features"</span>
  }
}
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] Defining 'great_module' ... OK</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"complex_module"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">great =</span> <span class="st">"great_module"</span>
) <span class="op">%provides%</span><span class="st"> </span>{
  <span class="cf">function</span>() <span class="kw">cat</span>(<span class="kw">paste</span>(<span class="st">"complex module using"</span>, <span class="kw">great</span>()))
}
<span class="co">#&gt; [2018-10-25T19:37:23 UTC] Defining 'complex_module' ... OK</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"complex_module"</span>)())
<span class="co">#&gt; [2018-10-25T19:37:24 UTC] Making 'complex_module' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:24 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:24 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:24 UTC] * Evaluating #1/1 (layer #1/1): 'great_module' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:24 UTC] DONE ('complex_module' in 0.033 secs)</span>
<span class="co">#&gt; complex module using great features</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.033   0.001   1.035</span></code></pre></div>
<p>In this scenario, <code>great_module</code> does what it is supposed to do, but clearly not very efficiently. You then decide to work on a new version that improves its performance.</p>
</div>
<div id="setting-up-versioning" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-up-versioning" class="anchor"></a>Setting-up versioning</h2>
<p>First, we clone <code>great_module</code> with an initial version number.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"great_module#0.1.0"</span> <span class="op">%clones%</span><span class="st"> "great_module"</span>
<span class="co">#&gt; [2018-10-25T19:37:25 UTC] Defining 'great_module#0.1.0' ... OK</span></code></pre></div>
<p>We then adapt the requirements where <code>great_module</code> is injected as a dependency: for <code>complex_module</code>, we decide to accept bug fixes, refactorisations, and new functionalities, as long as the API does not change in an incompatible backward manner.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"complex_module"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">great =</span> <span class="st">"great_module#^0.1.0"</span>
) <span class="op">%provides%</span><span class="st"> </span>{
  <span class="cf">function</span>() <span class="kw">cat</span>(<span class="kw">paste</span>(<span class="st">"complex module using"</span>, <span class="kw">great</span>()))
}
<span class="co">#&gt; [2018-10-25T19:37:25 UTC] Re-defining 'complex_module' ... OK</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"complex_module"</span>)())
<span class="co">#&gt; [2018-10-25T19:37:25 UTC] Making 'complex_module' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:25 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:25 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:25 UTC] * Evaluating #1/1 (layer #1/1): 'great_module#0.1.0' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:25 UTC] DONE ('complex_module' in 0.041 secs)</span>
<span class="co">#&gt; complex module using great features</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.043   0.001   1.044</span></code></pre></div>
<p>Here is the minor bump of <code>great_module</code>, which is a little bit more efficient.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"great_module#0.2.0"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="co"># Improved internals, same interface</span>
  <span class="cf">function</span>() <span class="st">"great optimisd features"</span>
}
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] Defining 'great_module#0.2.0' ... OK</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"complex_module"</span>)())
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] Making 'complex_module' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] * Evaluating #1/1 (layer #1/1): 'great_module#0.2.0' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] DONE ('complex_module' in 0.042 secs)</span>
<span class="co">#&gt; complex module using great optimisd features</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.044   0.000   0.044</span></code></pre></div>
<p>And here is the latest bug fix correcting the typo.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"great_module#0.2.1"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="co"># Bug fix</span>
  <span class="cf">function</span>() <span class="st">"great optimised features"</span>
}
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] Defining 'great_module#0.2.1' ... OK</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"complex_module"</span>)()
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] Making 'complex_module' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] * Evaluating #1/1 (layer #1/1): 'great_module#0.2.1' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] DONE ('complex_module' in 0.053 secs)</span>
<span class="co">#&gt; complex module using great optimised features</span></code></pre></div>
</div>
</div>
<div id="location-of-modules" class="section level1">
<h1 class="hasAnchor">
<a href="#location-of-modules" class="anchor"></a>Location of modules</h1>
<p>Modules can be defined in several locations: in-memory, on-disk in its own file or along another module’s file, and remotely on GitHub’s Gist or via the HTTP(S) protocol.</p>
<div id="in-memory" class="section level2">
<h2 class="hasAnchor">
<a href="#in-memory" class="anchor"></a>In-memory</h2>
<p>This is the most direct method to define a module. This is also the most volatile, since the lifespan of the module is limited to the R session.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"foo"</span> <span class="op">%provides%</span><span class="st"> "bar"</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] Defining 'foo' ... OK</span>
<span class="kw"><a href="../reference/list_modules.html">lsmod</a></span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">"name"</span>, <span class="st">"storage"</span>, <span class="st">"along"</span>, <span class="st">"filepath"</span>, <span class="st">"url"</span>))
<span class="co">#&gt;   name   storage along filepath  url</span>
<span class="co">#&gt; 1  foo in-memory  &lt;NA&gt;     &lt;NA&gt; &lt;NA&gt;</span></code></pre></div>
</div>
<div id="on-disk" class="section level2">
<h2 class="hasAnchor">
<a href="#on-disk" class="anchor"></a>On-disk</h2>
<p>This is the way to go when a module is intended to be reused. In such a case, the definition takes place in a dedicated R, R Markdown, or R Sweave file, which path and name are closely related to the module’s name.</p>
<p>For instance, the following module definition is stored in the R file <code>swissknife.R</code>, under the sub-directory <code>vendor/tool</code> of the <code>./modules</code> directory.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># File: ./modules/vendor/tool/swissknife.R</span>

<span class="kw">library</span>(modulr)

<span class="st">"vendor/tool/swissknife"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="kw">list</span>(
    <span class="dt">large_blade =</span> <span class="st">"Large blade"</span>,
    <span class="dt">small_blade =</span> <span class="st">"Small blade"</span>,
    <span class="dt">scissors =</span> <span class="st">"Scissors"</span>,
    <span class="dt">led_light =</span> <span class="st">"LED light"</span>
  )
}</code></pre></div>
<p>When a module is invoked, modulr searches for it in-memory first, then on-disk if necessary. There are several default <strong>root</strong> places where modulr looks for the module’s file: <code>./modules/</code>, <code>./module/</code>, <code>./libs/</code>, <code>./lib/</code>, and <code>./</code>. This behaviour can be configured with the help of <code>root_config</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">root_config<span class="op">$</span><span class="kw"><a href="../reference/config.html">get_all</a></span>()
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] "../../inst/modules"</span></code></pre></div>
<p>This explains why modulr finds the module <code>vendor/tool/swissknife</code> under the file <code>./modules/vendor/tool/swissknife.R</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_swissknife <span class="op">%&lt;=%</span><span class="st"> "vendor/tool/swissknife"</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] Making 'vendor/tool/swissknife' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] ** Defining 'vendor/tool/swissknife' ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] DONE ('vendor/tool/swissknife' in 0.035 secs)</span></code></pre></div>
<p>This also works with R Markdown <code>.Rmd</code> and R Sweave <code>.Rnw</code> files.</p>
<pre><code>&lt;!--- File: ./modules/vendor/tool/multitool.Rmd --&gt;

# Module `vendor/tool/multitool`

```{r}
library(modulr)

"vendor/tool/multitool" %provides% {
  list(
    pliers = "Pliers",
    keychain = "Keychain"
  )
}
```</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/load_module.html">load_module</a></span>(<span class="st">"vendor/tool/multitool"</span>) <span class="co"># load only, do not make</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] Defining 'vendor/tool/multitool' ... OK</span>
<span class="co">#&gt;                          vendor/tool/multitool </span>
<span class="co">#&gt; "../../inst/modules/vendor/tool/multitool.Rmd"</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/list_modules.html">lsmod</a></span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">"name"</span>, <span class="st">"storage"</span>, <span class="st">"along"</span>, <span class="st">"filepath"</span>, <span class="st">"url"</span>))
<span class="co">#&gt;                     name storage along</span>
<span class="co">#&gt; 1  vendor/tool/multitool on-disk  &lt;NA&gt;</span>
<span class="co">#&gt; 2 vendor/tool/swissknife on-disk  &lt;NA&gt;</span>
<span class="co">#&gt;                                       filepath  url</span>
<span class="co">#&gt; 1 ../../inst/modules/vendor/tool/multitool.Rmd &lt;NA&gt;</span>
<span class="co">#&gt; 2  ../../inst/modules/vendor/tool/swissknife.R &lt;NA&gt;</span></code></pre></div>
<p>Along a principal module, it is possible to define other related modules, for instance mock-ups and testing modules (cf. infra).</p>
</div>
<div id="remote-modulr-gears" class="section level2">
<h2 class="hasAnchor">
<a href="#remote-modulr-gears" class="anchor"></a>Remote (<em>modulr gears</em>)</h2>
<p>Using GitHub’s <a href="https://gist.github.com">Gist</a> is a simple way to share modules with others. To illustrate this, let us consider the following remote module, aka <strong>modulr gear</strong>: <a href="https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3" class="uri">https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"modulr/vault"</span> <span class="op">%imports%</span><span class="st"> "https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3"</span>
<span class="co">#&gt; [2018-10-25T19:37:26 UTC] Importing 'modulr/vault' from gist ID '3fcc508cb40ddac6c1e3' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:27 UTC] * Found 1 file(s) with R flavour (see https://gist.github.com/3fcc508cb40ddac6c1e3).</span>
<span class="co">#&gt; [2018-10-25T19:37:27 UTC] * Installing gear at '/tmp/Rtmpk83qfE/gears/modulr/vault/0c90e039fa2c76e3'.</span>
<span class="co">#&gt; [2018-10-25T19:37:27 UTC] DONE ('modulr/vault')</span>
<span class="co">#&gt; [2018-10-25T19:37:27 UTC] Defining 'modulr/vault/example_SECRET_' ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:27 UTC] Defining 'modulr/vault/example' ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:27 UTC] Defining 'modulr/vault#0.1.0' ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:27 UTC] Defining 'modulr/vault#0.1.0/mock' ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:27 UTC] Defining 'modulr/vault#0.1.0/test' ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:27 UTC] Digest of 'modulr/vault#0.1.0' is '390032bb2476c24e'.</span></code></pre></div>
<p>Notice that only specifiying the gist ID in <code>"modulr/vault" %imports% "3fcc508cb40ddac6c1e3"</code> has the same effect. It is possible to import modules from any URL using the HTTP(S) protocol.</p>
<p>Once imported, a remote module appears to be in-memory defined.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/list_modules.html">lsmod</a></span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">"name"</span>, <span class="st">"storage"</span>, <span class="st">"along"</span>, <span class="st">"filepath"</span>, <span class="st">"url"</span>))
<span class="co">#&gt;                           name   storage              along</span>
<span class="co">#&gt; 1         modulr/vault/example in-memory modulr/vault#0.1.0</span>
<span class="co">#&gt; 2 modulr/vault/example_SECRET_ in-memory modulr/vault#0.1.0</span>
<span class="co">#&gt; 3           modulr/vault#0.1.0 in-memory               &lt;NA&gt;</span>
<span class="co">#&gt; 4      modulr/vault#0.1.0/mock in-memory modulr/vault#0.1.0</span>
<span class="co">#&gt; 5      modulr/vault#0.1.0/test in-memory modulr/vault#0.1.0</span>
<span class="co">#&gt;           filepath                                                   url</span>
<span class="co">#&gt; 1 modulr-vault.Rmd https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3</span>
<span class="co">#&gt; 2 modulr-vault.Rmd https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3</span>
<span class="co">#&gt; 3 modulr-vault.Rmd https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3</span>
<span class="co">#&gt; 4 modulr-vault.Rmd https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3</span>
<span class="co">#&gt; 5 modulr-vault.Rmd https://gist.github.com/aclemen1/3fcc508cb40ddac6c1e3</span></code></pre></div>
<p>To use a remote module as a dependency, just import it where needed (even in a remote module).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"modulr/vault"</span> <span class="op">%imports%</span><span class="st"> "3fcc508cb40ddac6c1e3"</span>

<span class="st">"module/using/a/gear"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">vault =</span> <span class="st">"modulr/vault"</span>
) <span class="op">%provides%</span><span class="st"> </span>{
  vault<span class="op">$</span><span class="kw">decrypt</span>(
    <span class="dt">secret =</span> <span class="st">"TWUnCkRAlP70XvmRlnAFrw=="</span>,
    <span class="dt">key =</span> <span class="st">"EaJWzAZjjphu9CoA+MPUVCL8mmMAGp0j6Nbga29kV/A="</span>)
}
<span class="co">#&gt; [2018-10-25T19:37:27 UTC] Defining 'module/using/a/gear' ... OK</span>

<span class="kw"><a href="../reference/make.html">make</a></span>()
<span class="co">#&gt; [2018-10-25T19:37:27 UTC] Making 'module/using/a/gear' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:27 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:27 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:27 UTC] * Evaluating #1/1 (layer #1/1): 'modulr/vault#0.1.0' ...</span>
<span class="co">#&gt; Loading required package: base64enc</span>
<span class="co">#&gt; [2018-10-25T19:37:27 UTC] DONE ('module/using/a/gear' in 0.094 secs)</span>
<span class="co">#&gt; [1] "passw0rd"</span></code></pre></div>
<p>Notice that sharing a module is as easy as sending this one-liner code snippet:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(modulr); <span class="st">"modulr/vault#^0.1.0"</span> <span class="op">%imports%</span><span class="st"> "3fcc508cb40ddac6c1e3"</span></code></pre></div>
<p>Finally, private Gists and <a href="https://enterprise.github.com">GitHub Enterprise</a> users are also covered, thanks to GitHub’s <a href="https://github.com/blog/1509-personal-api-tokens">Personal Access Tokens</a> (PAT). For instance, with the GitHub Enterprise instance of the University of Lausanne:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Set 'GITHUB_PAT' in your '.Renviron' file or right here:</span>
<span class="co"># Sys.setenv(GITHUB_PAT = "Your Personal Access Token here")</span>

<span class="st">"modulr/private_GitHubEnterprise_module"</span> <span class="op">%imports%</span><span class="st"> </span>
<span class="st">  "https://github.unil.ch/api/v3/gists/1afa4770670975d70806c2153aac50a9"</span></code></pre></div>
<pre><code>#&gt; [2018-10-25T19:37:27 UTC] Importing 'modulr/private_GitHubEnterprise_module' from gist ID '1afa4770670975d70806c2153aac50a9' (endpoint 'https://github.unil.ch/api/v3') ...
#&gt; [2018-10-25T19:37:27 UTC] * Found 1 file(s) with R flavour (see https://github.unil.ch/gist/1afa4770670975d70806c2153aac50a9).
#&gt; [2018-10-25T19:37:27 UTC] * Installing gear at '/tmp/Rtmpk83qfE/gears/modulr/private_GitHubEnterprise_module/8b67316893a4db5d'.
#&gt; [2018-10-25T19:37:27 UTC] DONE ('modulr/private_GitHubEnterprise_module')
#&gt; [2018-10-25T19:37:27 UTC] Defining 'modulr/private_GitHubEnterprise_module' ... OK
#&gt; [2018-10-25T19:37:27 UTC] Digest of 'modulr/private_GitHubEnterprise_module' is 'efbb8ee38858aaef'.</code></pre>
<p>Let us assume that the following module is worth publishing:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"modulr/release_gist_example"</span> <span class="op">%provides%</span><span class="st"> "Hello World!"</span></code></pre></div>
<p>To release this module as a modulr gear on GitHub’s Gist, simply use <code>release_gear_as_gist</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/release_gear_as_gist.html">release_gear_as_gist</a></span>()</code></pre></div>
<pre><code>#&gt; [2018-10-25T19:37:28 UTC] Updating 'modulr-release_gist_example.Rmd' in gist ID '91ffa1950571b67d476131873a8a069b'.
#&gt; [2018-10-25T19:37:28 UTC] No changes found for 'modulr-release_gist_example.Rmd' in gist ID '91ffa1950571b67d476131873a8a069b'.</code></pre>
<p>The module is then publicly available here: <a href="https://gist.github.com/91ffa1950571b67d476131873a8a069b" class="uri">https://gist.github.com/91ffa1950571b67d476131873a8a069b</a>.</p>
</div>
</div>
<div id="special-variables" class="section level1">
<h1 class="hasAnchor">
<a href="#special-variables" class="anchor"></a>Special variables</h1>
<div id="last-name" class="section level2">
<h2 class="hasAnchor">
<a href="#last-name" class="anchor"></a><code>.Last.name</code>
</h2>
<p>When a module is defined, touched, or made, its name is always assigned to <code>.Last.name</code>. The special variable <code>.Last.name</code> is also used as a default parameter for <code>make</code>, <code>touch</code>, and <code>undefine</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"foo"</span> <span class="op">%provides%</span><span class="st"> "bar"</span>
<span class="co">#&gt; [2018-10-25T19:37:28 UTC] Defining 'foo' ... OK</span>

.Last.name
<span class="co">#&gt; [1] "foo"</span>

<span class="kw"><a href="../reference/make.html">make</a></span>()
<span class="co">#&gt; [2018-10-25T19:37:28 UTC] Making 'foo' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:28 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:28 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:28 UTC] DONE ('foo' in 0.032 secs)</span>
<span class="co">#&gt; [1] "bar"</span>

<span class="kw"><a href="../reference/touch.html">touch</a></span>()
<span class="co">#&gt; [2018-10-25T19:37:28 UTC] Touching 'foo' ... OK</span>

<span class="kw"><a href="../reference/undefine.html">undefine</a></span>()
<span class="co">#&gt; [2018-10-25T19:37:28 UTC] Undefining 'foo' ... OK</span></code></pre></div>
</div>
<div id="modules-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#modules-metadata" class="anchor"></a>Module’s metadata</h2>
<p>Every module has access to some of its metadata: name, version, file path (when on-disk), etc. The following module illustrates this feature and is self-explanatory.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># File: ./modules/my/great/module/reflection.R</span>

<span class="kw">library</span>(modulr)

<span class="st">"my/great/module/reflection#0.1.0"</span> <span class="op">%provides%</span><span class="st"> </span>{
  <span class="kw">list</span>(
    <span class="dt">.__name__ =</span> .__name__,
    <span class="dt">.__namespace__ =</span> .__namespace__,
    <span class="dt">.__initials__ =</span> .__initials__,
    <span class="dt">.__final__ =</span> .__final__,
    <span class="dt">.__version__ =</span> .__version__,
    <span class="dt">.__file__ =</span> .__file__,
    <span class="dt">.__path__ =</span> .__path__
  )
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/with_verbosity.html">with_verbosity</a></span>(0L, <span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"my/great/module/reflection"</span>))
<span class="co">#&gt; $.__name__</span>
<span class="co">#&gt; [1] "my/great/module/reflection#0.1.0"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $.__namespace__</span>
<span class="co">#&gt; [1] "my/great/module/reflection"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $.__initials__</span>
<span class="co">#&gt; [1] "my/great/module"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $.__final__</span>
<span class="co">#&gt; [1] "reflection"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $.__version__</span>
<span class="co">#&gt; [1] '0.1.0'</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $.__file__</span>
<span class="co">#&gt;                                                   my/great/module/reflection#0.1.0 </span>
<span class="co">#&gt; "/home/projects/aclemen1/RStudio/modulr/inst/modules/my/great/module/reflection.R" </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $.__path__</span>
<span class="co">#&gt; [1] "/home/projects/aclemen1/RStudio/modulr/inst/modules/my/great/module"</span></code></pre></div>
</div>
</div>
<div id="the-special-module-modulr" class="section level1">
<h1 class="hasAnchor">
<a href="#the-special-module-modulr" class="anchor"></a>The special module <code>modulr</code>
</h1>
<p>The modulr package defines a special module named <code>modulr</code> that can be injected in any module. The purpose of this special module is to give access to useful helper functions related to the module into which it is injected.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/print_info.html">info</a></span>(<span class="st">"modulr"</span>)
<span class="co">#&gt; # `modulr`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Access module helper functions.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The purpose of this special module is to give access to useful helper</span>
<span class="co">#&gt; functions related to the module into which it is injected.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ## Methods</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span><span class="al">###</span><span class="co"> `post_evaluation_hook(expr, add = FALSE)`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Records the expression given as its argument as needing to be executed</span>
<span class="co">#&gt; when the current module evaluation exits (either naturally or as the</span>
<span class="co">#&gt; result of an error). If no expression is provided, i.e., the call is</span>
<span class="co">#&gt; `post_evaluation_hook()`, then the current expression is removed. If</span>
<span class="co">#&gt; `add` is `TRUE`, `expr` is added after any previously set expressions;</span>
<span class="co">#&gt; otherwise (the default) `expr` will overwrite any previously set</span>
<span class="co">#&gt; expressions.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span><span class="al">###</span><span class="co"> `message_info(...)`, `message_warn(...)`, `message_stop(...)`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Outputs an informative, warning, or critical and stopping message,</span>
<span class="co">#&gt; prefixed with a timestamp and the module name. Such messages are</span>
<span class="co">#&gt; particularily useful in modules involved in long chains of dependencies</span>
<span class="co">#&gt; and workflows.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ## Deprecated methods</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span><span class="al">###</span><span class="co"> `get_module_name()`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Returns a string (character vector of lenght one) containing the module</span>
<span class="co">#&gt; name. Deprecated and kept for backward compatibility. Use `.__name__`</span>
<span class="co">#&gt; instead.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span><span class="al">###</span><span class="co"> `get_module_version()`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Returns the numeric version of the module. Deprecated and kept for</span>
<span class="co">#&gt; backward compatibility. Use `.__version__` instead.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span><span class="al">###</span><span class="co"> `get_module_options()`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Returns a list containing the module options. Deprecated and kept for</span>
<span class="co">#&gt; backward compatibility.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span><span class="al">###</span><span class="co"> `get_filename()`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Returns a string (character vector of lenght one) containing the module</span>
<span class="co">#&gt; filename. Deprecated and kept for backward compatibility. Use `.__path__`</span>
<span class="co">#&gt; and/or `.__file__` instead.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span><span class="al">###</span><span class="co"> `get_dirname()`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Returns a string (character vector of lenght one) containing the module</span>
<span class="co">#&gt; dirname. Deprecated and kept for backward compatibility. Use `.__path__`</span>
<span class="co">#&gt; and/or `.__file__` instead.</span></code></pre></div>
<div id="messages" class="section level2">
<h2 class="hasAnchor">
<a href="#messages" class="anchor"></a>Messages</h2>
<p>TODO</p>
</div>
<div id="post-evaluation-hook" class="section level2">
<h2 class="hasAnchor">
<a href="#post-evaluation-hook" class="anchor"></a>Post-evaluation hook</h2>
<p>There are situations where a post-evaluation hook is needed. For instance, to define an ephemeral module that can be evaluated only once, or to define a so-called <em>no-scoped</em> module, which looks like a pure singleton, but behaves like a prototype.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"ephemeral"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">modulr =</span> <span class="st">"modulr"</span>
) <span class="op">%provides%</span><span class="st"> </span>{
  modulr<span class="op">$</span><span class="kw"><a href="../reference/modulr-module.html">post_evaluation_hook</a></span>(<span class="kw"><a href="../reference/undefine.html">undefine</a></span>(<span class="st">"ephemeral"</span>))
  <span class="st">"A butterfly"</span>
}
<span class="co">#&gt; [2018-10-25T19:37:28 UTC] Defining 'ephemeral' ... OK</span>

<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"ephemeral"</span>) <span class="co"># returns a butterfly</span>
<span class="co">#&gt; [2018-10-25T19:37:28 UTC] Making 'ephemeral' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:28 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:29 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:29 UTC] * Evaluating #1/1 (layer #1/1): 'modulr#0.1.7.9203' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:29 UTC] * Undefining 'ephemeral' ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:29 UTC] DONE ('ephemeral' in 0.16 secs)</span>
<span class="co">#&gt; [1] "A butterfly"</span>
<span class="kw">try</span>(<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"ephemeral"</span>), <span class="dt">silent =</span> <span class="ot">TRUE</span>) <span class="co"># no more</span>
<span class="co">#&gt; [2018-10-25T19:37:29 UTC] Making 'ephemeral' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:29 UTC] * Visiting and defining dependencies ...</span>
<span class="kw">cat</span>(<span class="kw">geterrmessage</span>())
<span class="co">#&gt; Error : "ephemeral" is not defined.</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"no_scoped"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">modulr =</span> <span class="st">"modulr"</span>
) <span class="op">%provides%</span><span class="st"> </span>{
  modulr<span class="op">$</span><span class="kw"><a href="../reference/modulr-module.html">post_evaluation_hook</a></span>(<span class="kw"><a href="../reference/touch.html">touch</a></span>(<span class="st">"no_scoped"</span>))
  <span class="kw">Sys.time</span>()
}
<span class="co">#&gt; [2018-10-25T19:37:29 UTC] Defining 'no_scoped' ... OK</span>

<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"no_scoped"</span>)
<span class="co">#&gt; [2018-10-25T19:37:29 UTC] Making 'no_scoped' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:29 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:29 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:29 UTC] * Touching 'no_scoped' ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:29 UTC] DONE ('no_scoped' in 0.18 secs)</span>
<span class="co">#&gt; [1] "2018-10-25 19:37:29 UTC"</span>
<span class="kw">Sys.sleep</span>(1L)
<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"no_scoped"</span>)
<span class="co">#&gt; [2018-10-25T19:37:30 UTC] Making 'no_scoped' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:30 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:30 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:30 UTC] * Touching 'no_scoped' ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:30 UTC] DONE ('no_scoped' in 0.18 secs)</span>
<span class="co">#&gt; [1] "2018-10-25 19:37:30 UTC"</span></code></pre></div>
<p>Notice that the expression passed to the hook is evaluated in the environment in which the module is used. Therefore, a direct call to <code>.__name__</code> would not return the name of the intuitively expected module. The following example illustrates how to circumvent this kind of difficulty.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"no_scoped"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">modulr =</span> <span class="st">"modulr"</span>
) <span class="op">%provides%</span><span class="st"> </span>{
  <span class="kw">eval</span>(<span class="kw">substitute</span>(modulr<span class="op">$</span><span class="kw"><a href="../reference/modulr-module.html">post_evaluation_hook</a></span>(<span class="kw"><a href="../reference/touch.html">touch</a></span>(me)), <span class="kw">list</span>(<span class="dt">me =</span> .__name__)))
  <span class="kw">Sys.time</span>()
}
<span class="co">#&gt; [2018-10-25T19:37:30 UTC] Re-defining 'no_scoped' ... OK</span>

<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"no_scoped"</span>)
<span class="co">#&gt; [2018-10-25T19:37:30 UTC] Making 'no_scoped' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:30 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:30 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:30 UTC] * Touching 'no_scoped' ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:30 UTC] DONE ('no_scoped' in 0.25 secs)</span>
<span class="co">#&gt; [1] "2018-10-25 19:37:30 UTC"</span>
<span class="kw">Sys.sleep</span>(1L)
<span class="kw"><a href="../reference/make.html">make</a></span>(<span class="st">"no_scoped"</span>)
<span class="co">#&gt; [2018-10-25T19:37:31 UTC] Making 'no_scoped' ...</span>
<span class="co">#&gt; [2018-10-25T19:37:31 UTC] * Visiting and defining dependencies ...</span>
<span class="co">#&gt; [2018-10-25T19:37:31 UTC] * Constructing dependency graph ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:31 UTC] * Touching 'no_scoped' ... OK</span>
<span class="co">#&gt; [2018-10-25T19:37:31 UTC] DONE ('no_scoped' in 0.17 secs)</span>
<span class="co">#&gt; [1] "2018-10-25 19:37:31 UTC"</span></code></pre></div>
</div>
</div>
<div id="scripting" class="section level1">
<h1 class="hasAnchor">
<a href="#scripting" class="anchor"></a>Scripting</h1>
<p>Turning a bunch of modules working perfectly well together into a script is a very common situation, that can be handled with the help of the following boilerplate code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># filepath: ./script.R</span>
<span class="st">"script"</span> <span class="op">%requires%</span><span class="st"> </span><span class="kw">list</span>(
  <span class="dt">dep_1 =</span> <span class="st">"dependency_1"</span>,
  ...
) <span class="op">%provides%</span><span class="st"> </span>{
  <span class="cf">function</span>() {
    <span class="co"># body of the script here</span>
  }
}

<span class="cf">if</span> (.__name__ <span class="op">==</span><span class="st"> "__main__"</span>) 
  <span class="co"># execute only if sourced/run as a script (à la Python)</span>
  <span class="kw"><a href="../reference/make.html">make</a></span>()()</code></pre></div>
</div>
<div id="coding-style" class="section level1">
<h1 class="hasAnchor">
<a href="#coding-style" class="anchor"></a>Coding style</h1>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#anatomy-of-a-module">Anatomy of a module</a></li>
      <li><a href="#a-first-working-example">A first working example</a></li>
      <li>
<a href="#types-of-modules">Types of modules</a><ul class="nav nav-pills nav-stacked">
<li><a href="#singletons">Singletons</a></li>
      <li><a href="#prototypes">Prototypes</a></li>
      <li><a href="#memoised-prototypes">Memoised prototypes</a></li>
      <li><a href="#lists">Lists</a></li>
      <li><a href="#environments">Environments</a></li>
      <li><a href="#byte-compiled-modules">Byte-compiled modules</a></li>
      </ul>
</li>
      <li>
<a href="#semantic-versioning-semver">Semantic Versioning (SemVer)</a><ul class="nav nav-pills nav-stacked">
<li><a href="#initial-scenario-no-versioning">Initial scenario: no versioning</a></li>
      <li><a href="#setting-up-versioning">Setting-up versioning</a></li>
      </ul>
</li>
      <li>
<a href="#location-of-modules">Location of modules</a><ul class="nav nav-pills nav-stacked">
<li><a href="#in-memory">In-memory</a></li>
      <li><a href="#on-disk">On-disk</a></li>
      <li><a href="#remote-modulr-gears">Remote (<em>modulr gears</em>)</a></li>
      </ul>
</li>
      <li>
<a href="#special-variables">Special variables</a><ul class="nav nav-pills nav-stacked">
<li><a href="#last-name"><code>.Last.name</code></a></li>
      <li><a href="#modules-metadata">Module’s metadata</a></li>
      </ul>
</li>
      <li>
<a href="#the-special-module-modulr">The special module <code>modulr</code></a><ul class="nav nav-pills nav-stacked">
<li><a href="#messages">Messages</a></li>
      <li><a href="#post-evaluation-hook">Post-evaluation hook</a></li>
      </ul>
</li>
      <li><a href="#scripting">Scripting</a></li>
      <li><a href="#coding-style">Coding style</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Alain Clément-Pavon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
